var DISQUS=function(b){var d=b.DISQUS||{};d.AssertionError=function(b){this.message=b};d.AssertionError.prototype.toString=function(){return"Assertion Error: "+(this.message||"[no message]")};d.assert=function(e,g,f){if(!e)if(f)b.console&&b.console.log("DISQUS assertion failed: "+g);else throw new d.AssertionError(g);};var e=[];d.define=function(h,g){typeof h==="function"&&(g=h,h="");for(var f=h.split("."),n=f.shift(),a=d,o=(g||function(){return{}}).call({overwrites:function(a){a.__overwrites__=!0;
return a}},b);n;)a=a[n]?a[n]:a[n]={},n=f.shift();for(var k in o)o.hasOwnProperty(k)&&(!o.__overwrites__&&a[k]!==null&&d.assert(!a.hasOwnProperty(k),"Unsafe attempt to redefine existing module: "+k,!0),a[k]=o[k],e.push(function(a,k){return function(){delete a[k]}}(a,k)));return a};d.use=function(b){return d.define(b)};d.cleanup=function(){for(var b=0;b<e.length;b++)e[b]()};return d}(window);
DISQUS.define(function(b,d){var e=b.DISQUS,h=b.document,g=h.getElementsByTagName("head")[0]||h.body,f={running:!1,timer:null,queue:[]},n=0;e.getUid=function(a){var b=++n+"";return a?a+b:b};e.defer=function(a,b){function g(){var a=f.queue;if(a.length===0)f.running=!1,clearInterval(f.timer);for(var k=0,j;j=a[k];k++)j[0]()&&(a.splice(k--,1),j[1]())}f.queue.push([a,b]);g();if(!f.running)f.running=!0,f.timer=setInterval(g,100)};e.isOwn=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};e.isString=
function(a){return Object.prototype.toString.call(a)==="[object String]"};e.each=function(a,b){var g=a.length,d=Array.prototype.forEach;if(isNaN(g))for(var f in a)e.isOwn(a,f)&&b(a[f],f,a);else if(d)d.call(a,b);else for(d=0;d<g;d++)b(a[d],d,a)};e.extend=function(a){e.each(Array.prototype.slice.call(arguments,1),function(b){for(var g in b)a[g]=b[g]});return a};e.serializeArgs=function(a){var b=[];e.each(a,function(a,k){a!==d&&b.push(k+(a!==null?"="+encodeURIComponent(a):""))});return b.join("&")};
e.serialize=function(a,b,g){b&&(a+=~a.indexOf("?")?a.charAt(a.length-1)=="&"?"":"&":"?",a+=e.serializeArgs(b));if(g)return b={},b[(new Date).getTime()]=null,e.serialize(a,b);b=a.length;return a.charAt(b-1)=="&"?a.slice(0,b-1):a};var a,o;"addEventListener"in b?(a=function(a,b,g){a.addEventListener(b,g,!1)},o=function(a,b,g){a.removeEventListener(b,g,!1)}):(a=function(a,b,g){a.attachEvent("on"+b,g)},o=function(a,b,g){a.detachEvent("on"+b,g)});e.require=function(d,f,n,s,m){function j(a){a=a||b.event;
if(!a.target)a.target=a.srcElement;if(a.type=="load"||/^(complete|loaded)$/.test(a.target.readyState))s&&s(),v&&clearTimeout(v),o(a.target,w,j)}var u=h.createElement("script"),w=u.addEventListener?"load":"readystatechange",v=null;u.src=e.serialize(d,f,n);u.async=!0;u.charset="UTF-8";(s||m)&&a(u,w,j);m&&(v=setTimeout(function(){m()},2E4));g.appendChild(u);return e};e.requireStylesheet=function(a,b,d){var f=h.createElement("link");f.rel="stylesheet";f.type="text/css";f.href=e.serialize(a,b,d);g.appendChild(f);
return e};e.requireSet=function(a,b,g){var d=a.length;e.each(a,function(a){e.require(a,{},b,function(){--d===0&&g()})})};e.injectCss=function(a){var d=h.createElement("style");d.setAttribute("type","text/css");a=a.replace(/\}/g,"}\n");b.location.href.match(/^https/)&&(a=a.replace(/http:\/\//g,"https://"));d.styleSheet?d.styleSheet.cssText=a:d.appendChild(h.createTextNode(a));g.appendChild(d)};e.isString=function(a){return Object.prototype.toString.call(a)==="[object String]"}});
DISQUS.define("JSON",function(){function b(a){return a<10?"0"+a:a}function d(a){n.lastIndex=0;return n.test(a)?'"'+a.replace(n,function(a){var b=k[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(b,f){var w,v,k,n,h=a,q,p=f[b];p&&typeof p==="object"&&typeof p.toJSON==="function"&&!g&&(p=p.toJSON(b));typeof l==="function"&&(p=l.call(f,b,p));switch(typeof p){case "string":return d(p);case "number":return isFinite(p)?String(p):"null";case "boolean":case "null":return String(p);
case "object":if(!p)return"null";a+=o;q=[];if(Object.prototype.toString.apply(p)==="[object Array]"){n=p.length;for(w=0;w<n;w+=1)q[w]=e(w,p)||"null";k=q.length===0?"[]":a?"[\n"+a+q.join(",\n"+a)+"\n"+h+"]":"["+q.join(",")+"]";a=h;return k}if(l&&typeof l==="object"){n=l.length;for(w=0;w<n;w+=1)v=l[w],typeof v==="string"&&(k=e(v,p))&&q.push(d(v)+(a?": ":":")+k)}else for(v in p)Object.hasOwnProperty.call(p,v)&&(k=e(v,p))&&q.push(d(v)+(a?": ":":")+k);k=q.length===0?"{}":a?"{\n"+a+q.join(",\n"+a)+"\n"+
h+"}":"{"+q.join(",")+"}";a=h;return k}}var h={},g=!1;if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,a,o,k={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;h.stringify=function(b,g,d){var f;o=a="";if(typeof d==="number")for(f=0;f<d;f+=1)o+=" ";else typeof d==="string"&&(o=d);if((l=g)&&typeof g!=="function"&&(typeof g!=="object"||typeof g.length!=="number"))throw Error("JSON.stringify");return e("",{"":b})};h.parse=function(a,b){function g(a,
d){var j,q,p=a[d];if(p&&typeof p==="object")for(j in p)Object.hasOwnProperty.call(p,j)&&(q=g(p,j),q!==void 0?p[j]=q:delete p[j]);return b.call(a,d,p)}var d,a=String(a);f.lastIndex=0;f.test(a)&&(a=a.replace(f,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),
typeof b==="function"?g({"":d},""):d;throw new SyntaxError("JSON.parse");};var t={a:[1,2,3]},s,m;if(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")==='{"a":[1,2,3]}')s=Object.toJSON;typeof String.prototype.evalJSON==="function"&&(t='{"a":[1,2,3]}'.evalJSON(),t.a&&t.a.length===3&&t.a[2]===3&&(m=function(a){return a.evalJSON()}));(function(){var a=[1,2,3];typeof a.toJSON==="function"&&(a=a.toJSON(),g=!(a&&a.length===3&&a[2]===3))})();if(g||!s||!m)return{stringify:h.stringify,parse:h.parse};return{stringify:s,
parse:m}});
DISQUS.define("Bus",function(){function b(b){b=b.split("/");return b[0]+"//"+b[2]}var d=DISQUS.use("JSON"),e=window.location.hash.slice(1),h=window.opener||window.parent,g=document.referrer,f={};f.client=b(document.location.href);f.host=g?b(g):f.client;return{origins:f,messageHandler:function(b){var a;try{a=DISQUS.JSON.parse(b.data)}catch(d){return}if(!a.name||!(a.name[0]==="!"&&b.origin!==f.client))switch(a.scope){case "client":DISQUS.Bus.trigger(a.name,a.data)}},postMessage:function(b){b.sender=e;
b=d.stringify(b);h.postMessage(b,"*")},sendHostMessage:function(b,a){a=a||[];DISQUS.Bus.postMessage({scope:"host",name:b,data:a})},sendGlobalMessage:function(b,a){a=a||[];DISQUS.Bus.postMessage({scope:"global",name:b,data:a})}}});_.extend(DISQUS.Bus,Backbone.Events);(function(){var b=window.addEventListener?window.addEventListener:window.attachEvent,d=window.addEventListener?"message":"onmessage";if(!b)throw Error("No event support.");b(d,DISQUS.Bus.messageHandler,!1);window.onunload=function(){DISQUS.Bus.sendHostMessage("die")}})();
DISQUS.define(function(){return{apiKey:"E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F",debug:!1,browser:{mobile:/iPhone|Android|iPod|iPad|webOS|Mobile Safari|Windows Phone|BlackBerry|Opera Mini|IEMobile/i.test(navigator.userAgent)}}});
DISQUS.define("strings",function(){function b(b){var d=e[b];return d!==void 0?d:b}function d(b,d){return b.replace(/%\(\w+\)s/g,function(f){var f=f.slice(2,-2),e="";f in d?e=d[f]!==void 0&&d[f]!==null?d[f].toString():"":DISQUS.logError&&DISQUS.logError("Key `"+f+"` not found in context for: ",b);return e})}var e={};DISQUS.interpolate=d;DISQUS.modules={};window.gettext=b;return{get:b,interpolate:d,translations:e}});
DISQUS.define("time",function(){return{ISO_8601:"YYYY-MM-DDTHH:mm:ssZ",assureTzOffset:function(b){return b.indexOf("+")>=0?b:b+"+00:00"}}});
DISQUS.define("urls",function(){var b=DISQUS.debug?"/js/src/embed/next/vglnk.js":"/build/next/alfie.js",d=encodeURIComponent(document.referrer),e={root:"http://disqus.com",media:"http://mediacdn.disqus.com/1375384862",translations:"http://mediacdn.disqus.com/1375384862/build/lang",loading:"http://mediacdn.disqus.com/1375384862/html/simple-loading.html",realertime:"//realtime.services.disqus.com",juggler:"//juggler.services.disqus.com",login:"https://disqus.com/next/login/",api:"http://disqus.com/api/3.0/",
apiSecure:"https://disqus.com/api/3.0/",logout:"http://disqus.com/logout/?redirect="+d,editProfile:"http://disqus.com/account/",verifyEmail:"https://disqus.com/next/verify/",authorize:"https://disqus.com/api/oauth/2.0/authorize/",moderate:"http://disqus.com/admin/moderate/",oauth:{twitter:"http://disqus.com/_ax/twitter/begin/",google:"http://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"http://mediacdn.disqus.com/1375384862/images/noavatar92.png"},
linkAffiliatorClient:"http://mediacdn.disqus.com/1375384862"+b};window.location.protocol==="https:"&&(e=_.extend(e,{root:"https://disqus.com",media:"https://securecdn.disqus.com/1375384862",translations:"https://securecdn.disqus.com/1375384862/build/lang",loading:"https://securecdn.disqus.com/1375384862/html/simple-loading.html",api:e.apiSecure,logout:"https://disqus.com/logout/?redirect="+d,editProfile:"https://disqus.com/account/",moderate:"https://disqus.com/admin/moderate/",oauth:{twitter:"https://disqus.com/_ax/twitter/begin/",
google:"https://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"https://securecdn.disqus.com/1375384862/images/noavatar92.png"},linkAffiliatorClient:"https://securecdn.disqus.com/1375384862"+b}));return e});
DISQUS.define("templates",function(){function b(b,h){var g=Handlebars.partials[b](h||{},{data:d});if($.trim)return $.trim(g);return g}var d={urls:DISQUS.urls,gettext:DISQUS.strings.get,sso:null};DISQUS.renderBlock=b;DISQUS.templateGlobals=d;return{globals:d,render:b}});
DISQUS.define("api",function(){function b(b){function d(a){var k=a.originalEvent.origin;DISQUS.urls.apiSecure.slice(0,k.length)===k&&(a=DISQUS.JSON.parse(a.originalEvent.data),a.requestId===e&&(k=a.code===0?b.success:b.error,delete a.requestId,(k||function(){})(a),document.body.removeChild(l),document.body.removeChild(h),$(window).off("message",d)))}var e=_.uniqueId("ft_"),a=document.createElement("div"),h=document.createElement("form"),k="frame_"+e,l;a.innerHTML='<iframe name="'+k+'"></iframe>';
l=a.childNodes[0];h.target=k;h.action=b.url.replace(".json",".pm");h.method=b.method||"GET";b.data=_.extend(b.data,{callback:e,referrer:document.referrer});_.each(b.data,function(a,b){a===!0?a=[1]:a===!1?a=[0]:a===null?a=[""]:_.isArray(a)||(a=[a]);_.each(a,function(a){var d=document.createElement("input");d.type="hidden";d.name=b;d.value=a;h.appendChild(d)})});$(window).on("message",d);document.body.appendChild(l);document.body.appendChild(h);h.submit()}function d(b){b=_.defaults(b,e);b.traditional=
!0;if(!b.omitDisqusApiKey)b.data=b.data||{},b.data.api_key=DISQUS.apiKey;return $.ajax(b)}var e={},h={defaults:function(b){var d,h,a;for(d in b)h=b[d],a=e[d],_.isObject(h)&&_.isObject(a)?_.extend(a,h):e[d]=h},headers:function(b){b=_.extend({},e.headers,b);e.headers=_.pick(b,_.map(b,function(b,d){if(b)return d}));return e.headers},getURL:function(b,d){d=d||{};if(d.secure||window.location.protocol==="https:")return DISQUS.urls.apiSecure+b;return DISQUS.urls.api+b},ajax:d,call:function(g,f){f=f||{};
f.url=DISQUS.api.getURL(g,{secure:f.secure});f.data=_.extend(f.data||{},{api_key:DISQUS.apiKey});this.trigger("call",f);var e=(f.secure?b:d)(f);e&&e.always(_.bind(this.trigger,this,"complete"));return e}};_.extend(h,Backbone.Events);return h});
(function(b){b.ajax=function(b){if(window.$&&window.$.fn&&window.$.fn.jquery&&window.$.fn.jquery.indexOf("1.9.2")>-1){if(b.dataType=="jsonp")b.cache=!0}else b.method=b.type,b.type=b.dataType,delete b.dataType;return DISQUS.api.ajax(b)};b.Collection.prototype.parse=function(b){return b.response}})(Backbone);
DISQUS.define("ga",function(b){var d,e=function(e){d?d(e):b._gaq.push(e)},h={component:1,"package":2,forum:3,version:4,userType:5};return{setCaller:function(b){d=b},setAccount:function(b){e(["_setAccount",b])},setCustomVar:function(b,d){e(["_setCustomVar",h[b],b,d])},trackPageview:function(){e(["_trackPageview"])},trackEvent:function(b,d,h){e(["_trackEvent",d,b,h,1])},setDomainName:function(b){e(["_setDomainName",b])}}});
DISQUS.define("juggler",function(b){function d(){try{var a=(new Date).getTimezoneOffset(),d=1,e=b.screen;e&&e.availWidth?d=e.availWidth*e.availHeight+e.colorDepth:e&&e.width&&(d=e.width*e.height);var f=document.documentElement;return Math.abs(a*17+d*25-f.clientWidth*f.clientHeight)}catch(h){return 1}}function e(){try{var a=new Uint32Array(1);return b.crypto.getRandomValues(a)[0]}catch(d){return Math.floor(Math.random()*1E9)}}function h(){if(b.performance&&b.performance.timing){var a=b.performance.timing;
return(a.domainLookupEnd-a.domainLookupStart)*11+(a.connectEnd-a.connectStart)*13+(a.responseStart-a.navigationStart)*17}return 1E5}function g(){return+(new Date).getTime().toString().substring(3)}var f=Math.abs(g()+h()-d()).toString(32);f+=e().toString(32);var n={},a=function(a){n[a]=this;this._emit=null;this.meta={};this.allowedOverwrites=["thread","forum","forum_id","user_id"];this.reservedKeys=this.allowedOverwrites.slice().concat(["imp","event","prev_imp"]);this.preloadBuffer=[]};DISQUS.extend(a.prototype,
{disable:function(){this._emit=function(){};this.preloadBuffer=[]},copySettings:function(){return DISQUS.extend({},this.settings,this.meta)},overwrite:function(a){for(var b=0,d=this.allowedOverwrites.length;b<d;b++){var e=this.allowedOverwrites[b];a.hasOwnProperty(e)&&(this.meta[e]=a[e])}},load:function(a){var d=this;d.settings=a;d.url=a.url;if(a.disable)return void d.disable();if(b.location.protocol==="https:"){if(a.disableSSL)return void d.disable();d.url=d.url.replace("http:","https:")}DISQUS.each(d.allowedOverwrites,
function(b){d.meta[b]=a[b]});d.meta.imp=f;d.meta.prev_imp=DISQUS.cookies.read("__jid");DISQUS.cookies.create("__jid",f,{expiresIn:18E5});d._emit=function(a){DISQUS.each(d.meta,function(b,e){a[e]=d.meta[e]});DISQUS.require(d.url,a,!1)};DISQUS.each(d.preloadBuffer,function(a){d._emit(a)})},emit:function(a,b){b=DISQUS.extend({},b);DISQUS.each(this.reservedKeys,function(a){if(b[a]!=null)throw"Error: cannot overwrite event context '"+a+"'";});b.event=a;this._emit==null?this.preloadBuffer.push(b):this._emit(b)}});
return{getFingerprint:d,getTime:g,getRandom:e,getNavigationTime:h,client:function(b,d){return n[b]||d&&new a(b)},impId:f}});
DISQUS.define("next.intelligence",function(){function b(b){return b.has("remote")?b.get("remote").domain:b.id?"disqus":"not_logged_in"}function d(b){return b.support_preferred?"plus":b.support_priority?"pro":b.support_vip?"vip":"free"}function e(){f.trackPageview()}function h(b,a){f.setCustomVar(b,a)}function g(){this.userType=this.forum=null}var f=DISQUS.use("ga");g.prototype.init=function(b){b=b||{};h("component","embed");h("version","next");if(b.forum)this.forum=b.forum,h("forum",b.forum);b.features&&
h("package",d(b.features));this.setSession(b.session||"not_logged_in");e()};g.prototype.setSession=function(d){d=_.isString(d)?d:b(d);if(d!==this.userType)this.userType=d,h("userType",d)};g.prototype.trackEvent=function(b){f.trackEvent(b,"next",this.forum)};return{Intelligence:g,setCustomVar:h,trackPageview:e,getUserType:b,getPackageType:d}});
DISQUS.define("cookies",function(){return{create:function(b,d,e){b=b+"="+d+"; path=/";e.domain&&(b+="; domain=."+e.domain);e.expiresIn&&(d=new Date,d.setTime(d.getTime()+e.expiresIn),b+="; expires="+d.toGMTString());document.cookie=b},read:function(b){b+="=";for(var d=document.cookie.split(";"),e,h=0;h<d.length;h++){for(e=d[h];e.charAt(0)==" ";)e=e.substring(1,e.length);if(e.indexOf(b)===0)return e.substring(b.length,e.length)}return null},erase:function(b,d){var e=new Date;e.setTime(e.getTime()+
-864E5);e=b+"=; path=/;expires="+e.toGMTString();d.domain&&(e+="; domain=."+d.domain);document.cookie=e}}});
DISQUS.define("next.utils",function(){function b(a){function b(a){a=Number(a).toString(16);return a.length==1?"0"+a:a}if(a.substr(0,1)==="#")return a;var d=/.*?rgb\((\d+),\s*(\d+),\s*(\d+)\)/.exec(a);if(!d||d.length!==4)return"";var a=b(d[1]),j=b(d[2]),d=b(d[3]);return"#"+a+j+d}function d(a){return a.split("/")[2].replace(/\:[0-9]+/,"")}function e(a,b){b=b||document.referrer||"";a=a.replace(l,"");b=b.replace(l,"");return a&&a!==b}var h={handler:function(a,b,d){a&&d>=200&&d<300?a():b&&(d<200||d>=300)&&
b()},XHR2:function(a,b,d,j){var e=h.handler,q=new XMLHttpRequest;q.open(a,b,!0);q.onreadystatechange=function(){q.readyState===XMLHttpRequest.DONE&&e(d,j,q.status)};return q},XDR:function(a,b,d,j){if(a!=="GET"&&a!=="POST")return null;var e=h.handler,q=new XDomainRequest;q.open(a,b);q.onload=_.bind(e,window,d,j,200);q.ontimeout=q.onerror=_.bind(e,window,d,j,500);return q}};h.request=function(){return"withCredentials"in new XMLHttpRequest?h.XHR2:window.XDomainRequest?h.XDR:function(){return null}}();
var g=RegExp("[\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E\\u00A1-\\u00BF\\u2010-\\u2027\\u2030-\\u205E\\u2300-\\u23FF\\u2E00-\\u2E7F\\u3001-\\u303F\\uFE10-\\uFE19\\uFE30-\\uFE4F\\uFE50-\\uFE6B\\uFF01-\\uFF0F\\uFF1A-\\uFF20\\uFF3B-\\uFF40\\uFF5B-\\uFF60\\uFF5F-\\uFF64]+$"),f={domain:d(DISQUS.urls.root),create:function(a,b){DISQUS.cookies.create(a,b,{domain:f.domain,expiresIn:31536E6})},read:DISQUS.cookies.read,erase:function(a){DISQUS.cookies.erase(a,{domain:f.domain})}},n=function(){var a=
{};return{getItem:function(b){return a.hasOwnProperty(b)?a[b]:null},setItem:function(b,d){a[b]=String(d)},removeItem:function(b){delete a[b]}}}(),a=/^[a-z0-9_.%+\-]+@[0-9a-z.\-]+\.[a-z.]{2,6}$/i,o=function(){function a(){this.state=null;this.queue=[]}_.extend(a.prototype,{highlight:function(a){this.state===null&&this._load();this.queue.push(a);this.state===2&&this._flush()},_load:function(){var a=this;a.state=1;DISQUS.require("http://mediacdn.disqus.com/1375384862/build/js/highlight.js",{},!1,function(){a.state=
2;a._flush()})},_flush:function(){_.chainedDefer(this.queue,function(a){var b=$(a).html();$(a).html(b.replace(/^<br>/,""));hljs.highlightBlock(a)},this)}});return new a}(),k=function(){var a=document.createElement("fakeelement"),b={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},d;for(d in b)if(a.style[d]!==void 0)return b[d];return null}(),l=/\#.*/,t=function(a){var b=a.href,d;if(e(b)&&(a=$(a).closest("[data-outbound-link]"),
a.length&&(d=a[0].getAttribute("data-outbound-link")),d))return{bin:d,url:b}},s=0,m=function(a){var b=a.getAttribute("data-link-hash");b||(b=s++,a.setAttribute("data-link-hash",b));return b.toString()},j={},u=function(a,b){var d=a.currentTarget,e=t(d);if(e){var f=m(d);j[f]&&new Date-j[f]<=1500||(DISQUS.juggler&&(DISQUS.juggler.client("juggler",!0).emit("click",e),j[f]=new Date),b&&(a.preventDefault(),_.delay(function(){var a=$(d);a.triggerClick?a.triggerClick():a.click()},100)))}};return{attempt:function(a,
b){try{_.bind(a,b||{})()}catch(d){return d}return null},extract:function(a,b){for(var d=b.split("."),e=d.shift();e;){if(d.length===0)return a[e];if(!_.isObject(a[e]))return;a=a[e];e=d.shift()}return a},addStylesheetRules:function(a){function b(){var e=_.find(document.styleSheets,function(a){return(a.ownerNode||a.owningElement).id===d});if(!e)return void setTimeout(b,50);for(var q=0,p=a.length;q<p;q++){var j=1,f=a[q],h=f[0],g="";Object.prototype.toString.call(f[1][0])==="[object Array]"&&(f=f[1],j=
0);for(var k=f.length;j<k;j++){var u=f[j];g+=u[0]+":"+u[1]+(u[2]?" !important":"")+";\n"}e.insertRule?e.insertRule(h+"{"+g+"}",e.cssRules.length):e.addRule(h,g,-1)}}var d="css_"+(new Date).getTime(),e=document.createElement("style");e.id=d;document.getElementsByTagName("head")[0].appendChild(e);window.createPopup||e.appendChild(document.createTextNode(""));b()},escapeColor:function(a){return b(a).replace(/[^#A-Fa-f0-9]/g,"")},CORS:h,hashStorage:n,cookies:f,extractDomainForCookies:d,niceTruncate:function(a,
b){if(a.length<=b)return a;var d=a=a.slice(0,b-1),e=/(^.*\S)\s/.exec(a);e&&(a=e[1]);(e=g.exec(a))&&(a=a.slice(0,a.length-e[0].length));a.length<0.5*d.length&&(a=d);return a+"\u2026"},htmlDecode:function(a){var b=document.createElement("div");b.innerHTML=a;return b.childNodes.length===0?"":b.childNodes[0].nodeValue},isWindowClosed:function(a){if(!a)return!0;try{return a.closed||a.closed===void 0}catch(b){return!0}},validateEmail:function(b){return a.test(b)},updateURL:function(a,b){var d=document.createElement("a"),
b=b||{};d.href=a;b.hostname&&b.hostname.match(/\.$/)&&(b.hostname+=d.hostname);d=_.extend({protocol:d.protocol,hostname:d.hostname,pathname:d.pathname,search:d.search},b);if(!d.pathname.match(/^\//))d.pathname="/"+d.pathname;return d.protocol+"//"+d.hostname+d.pathname+d.search},injectBaseElement:function(a,b){var b=b||document,d=b.getElementsByTagName("base")[0]||b.createElement("base");d.target="_parent";d.href=a;d.parentNode||(b.head||b.getElementsByTagName("head")[0]).appendChild(d)},syntaxHighlighter:o,
transitionEndEvent:k,sendStat:function(a,b){b||(b=1E5);if(Math.random()<=1/b)(new Image).src=DISQUS.serialize(DISQUS.urls.juggler+"/stat.gif",{event:a})},getPageHeight:function(){return $("body").height()},getClickEventParams:t,logLinkClick:u,logLinkClickContinueNavigation:function(a){return u(a,!0)},isOutbound:e,getOrSetLinkHash:m}});
DISQUS.define("next.realtime",function(b){function d(){f.apply(this,arguments);this.marker=this.reqCounter=0;this.interval=1;this._boundOnError=_.bind(this.onError,this);this._boundOnLoad=_.bind(this.onLoad,this);this._boundOnProgress=_.bind(this.onProgress,this)}function e(){f.apply(this,arguments);this.handshakeSuccess=null;this.interval=1;this._boundOnOpen=_.bind(this.onOpen,this);this._boundError=_.bind(this.onError,this);this._boundClose=_.bind(this.onClose,this);this._boundMessage=_.compose(_.bind(this.onMessage,
this),function(a){return JSON.parse(a.data)})}var h=DISQUS.use("next.utils"),g=function(){},f=function(a,b){this.channel=a;this.since=b;this.connection=null;this.paused=!1;this._msgBuffer=[];this._boundOpen=_.bind(this.open,this)};_.extend(f.prototype,Backbone.Events,{getUrl:function(a){var b={};if(this.since)b.since=this.since;_.extend(b,a);return DISQUS.serialize(this.baseUrl+this.channel,b)},onMessage:function(a){var b=a.message_type,d=a.firehose_id;this.lastEventId=d;DISQUS.log("RT: new message:",
b,d);this.trigger(b,{type:b,data:a.message_body,lastEventId:d})},_msgToBuffer:function(){this._msgBuffer.push(_.toArray(arguments))},pause:function(a){if(!this.paused)this.paused=!0,this._trigger=this.trigger,this.trigger=a===!1?g:this._msgToBuffer,DISQUS.log("RT: paused, buffered: %s",a!==!1)},resume:function(){if(this.paused){this.paused=!1;this.trigger=this._trigger;DISQUS.log("RT: resumed, buffered messages: %s",this._msgBuffer.length);for(var a;a=this._msgBuffer.shift();)this.trigger.apply(this,
a)}},open:function(){throw Error("Pipe class cannot be used directly.");},close:function(){var a=this.connection;if(!a)return!1;this.connection=null;return a}});_.extend(d.prototype,f.prototype,{baseUrl:DISQUS.urls.realertime+"/api/2/",onError:function(){if(this.connection)this.connection=null,this.trigger("error",this),this.interval<=120&&(this.interval*=2),h.sendStat("rt_streampipe_error"),DISQUS.logError("RT: Connection error, backing off %s secs",this.interval),_.delay(this._boundOpen,this.interval*
1E3)},onLoad:function(){if(this.connection)this.since=this.connection=null,this.trigger("success",this),h.sendStat("rt_streampipe_close"),_.defer(this._boundOpen)},onProgress:function(){if(this.connection){var a=this.connection.responseText,b=0;if(a&&!(this.marker>=a.length)){for(var a=a.slice(this.marker).split("\n"),d,e,f,h=a.length,g=0;g<h;g++)if(d=a[g],b+=d.length+1,e=d.replace(/^\s+|\s+$/g,"")){try{f=JSON.parse(e)}catch(j){if(g===h-1){b-=d.length+1;break}else{DISQUS.log("RT: unable to parse: ",
e,d);continue}}this.onMessage(f)}else DISQUS.log("RT: ignoring empty row...");b>0&&(this.marker+=b-1)}}},open:function(){this.close();var a=this.connection=h.CORS.request("GET",this.getUrl({bust:++this.reqCounter}),this._boundOnLoad,this._boundOnError);if(!a)return h.sendStat("rt_streampipe_cors_unavail"),void DISQUS.log("RT: Cannot use any cross-domain request tool with StreamPipe. Bailing out.");a.onprogress=this._boundOnProgress;this.connection=a;this.marker=0;try{a.send()}catch(b){this.connection=
null,h.sendStat("rt_streampipe_cors_fail"),DISQUS.log("RT: Attempt to send a CORS request failed.")}},close:function(){var a=f.prototype.close.apply(this);return a&&a.abort()}});_.extend(e.prototype,f.prototype,{baseUrl:(b.location.protocol==="https:"?"wss:":"ws:")+DISQUS.urls.realertime+"/ws/2/",onOpen:function(){DISQUS.log("RT: [Socket] Connection established.");this.handshakeSuccess=!0;this.since=null},onError:function(){if(this.connection)this.connection=null,this.handshakeSuccess?(this.trigger("error"),
this.interval<=120&&(this.interval*=2),h.sendStat("rt_socketpipe_error"),DISQUS.logError("RT: Connection error, backing off %s secs",this.interval),_.delay(this._boundOpen,this.interval*1E3)):(DISQUS.log("RT: [Socket] Error before open, bailing out."),h.sendStat("rt_socketpipe_fail"),this.trigger("fail"))},onClose:function(a){if(this.connection)a.wasClean?(this.connection=null,h.sendStat("rt_socketpipe_clean_close"),DISQUS.log("RT: [Socket] Connection closed. Restarting..."),this.trigger("close"),
this.open()):(h.sendStat("rt_socketpipe_unclean_close"),this.onError())},open:function(){this.close();var a=this.connection=new b.WebSocket(this.getUrl());a.onopen=this._boundOnOpen;a.onerror=this._boundError;a.onmessage=this._boundMessage;a.onclose=this._boundClose},close:function(){var a=f.prototype.close.apply(this);return a&&a.close()}});var n={_wsSupported:b.WebSocket&&WebSocket.CLOSING===2,initialize:function(a,b,f,h){this.close();this._initArgs=[a,b,f,h];var g=this._wsSupported,n=this.pipe=
new (g?e:d)(a,b);_.chain(f).pairs().each(function(a){n.on(a[0],a[1],h)});if(g)n.on("fail",function(){this._wsSupported=!1;n.off();this.initialize.apply(this,this._initArgs)},this);n.open()},pause:function(a){this.pipe&&this.pipe.pause(a)},resume:function(){this.pipe&&this.pipe.resume()},close:function(){if(this.pipe)this.pipe.close(),this.pipe=null}};$(b).on("unload",_.bind(n.close,n));return{Pipe:f,StreamPipe:d,SocketPipe:e,Manager:n}});
DISQUS.define("next.models",function(){function b(a,d,e){var j=b.pool(a),f=d&&d[a.prototype.idAttribute];if(!f)return new a(d,e);b.get(a,f)?j[f].set(d):j[f]=new a(d,e);return j[f]}var d=DISQUS.use("next.collections"),e=DISQUS.use("next.utils"),h=DISQUS.strings.get;b.pool={};b.pool=function(a){a=b.pool[a.__type__];if(!a)throw Error("Model not registered. Use UniqueModel.addType");return a};b.get=function(a,d){return b.pool(a)[d]};b.addType=function(a,d){if(!d.__type__||!b.pool[a])d.__type__=a,b.pool[a]=
{}};var g=Backbone.Model.extend({defaults:{settings:{}}}),f={getRelativeCreatedAt:function(){var a=this.get("createdAt");if(a)return a=DISQUS.time.assureTzOffset(a),moment(a,DISQUS.time.ISO_8601).fromNow()}},n=Backbone.Model.extend({defaults:{author:null,category:null,createdAt:null,forum:null,identifiers:[],ipAddress:null,isClosed:!1,isDeleted:!1,hasStreaming:!1,link:null,message:null,slug:null,title:null,userSubscription:!1,posts:0,likes:0,dislikes:0,userScore:0},initialize:function(a,b){var e=
this,b=b||{};e.moderators=b.moderators;e.forum=b.forum;e.users=new d.UserCollection(b.users,{thread:e});e.posts=new d.PostCollection(b.posts,{thread:e,cursor:b.postCursor,order:b.order});e.votes=new d.ThreadVoteCollection;e.posts.on("add reset",function(a){a=a.models?a.models:[a];_.each(a,function(a){e.users.get(a.author.id)||e.users.add(a.author)});e.set("posts",Math.max(e.posts.length,e.get("posts")))});e.posts.on("destroy",function(){e.set("posts",e.get("posts")-1)});e.queue=new d.QueuedPostCollection(null,
{thread:e})},_vote:function(a,b){var d=a-b;if(d===0)return d;this.set("likes",this.get("likes")+d);return d},vote:function(a){var b=this;b._vote(a,b.get("userScore"))!==0&&(this.set("userScore",a),DISQUS.api.call("threads/vote.json",{data:{thread:this.id,vote:a},method:"POST",success:function(d){d.response.id&&(b.votes.get(d.response.id)||b.votes.add({id:d.response.id,score:a}))}}))},fetch:function(a){var b=this,d=b.attributes,a=a||{};DISQUS.api.call("threads/details.json",{data:{thread:d.identifier?
"ident:"+d.identifier:"link:"+d.url,forum:d.forum},success:function(d){b.set(d.response);a.success&&a.success()},error:function(){DISQUS.debug?b.save({},{success:a.success}):console.log("Couldn't find thread; not creating in production.")}})},_toggleState:function(a,b){b||(b={});var d=a?"open.json":"close.json";this.set("isClosed",!a);DISQUS.api.call("threads/"+d,{method:"POST",data:{thread:this.id},success:b.success,error:b.error})},open:function(a){this._toggleState(!0,a)},close:function(a){this._toggleState(!1,
a)},sync:function(){var a=this,b=a.attributes;DISQUS.api.call("threads/create.json",{data:{title:b.title,forum:b.forum,identifier:b.identifier,url:b.url},method:"POST",success:function(b){a.set(b.response)}})},incrementPostCount:function(a){this.set("posts",this.get("posts")+a)},isModerator:function(a){if(this.moderators)return a=a instanceof m||_.isObject(a)?a.id:a,a=parseInt(a,10),_(this.moderators).contains(a)},subscribe:function(a,b){var a=a!==!1,d=this.get("userSubscription");if(d!=a){a?this.set("userSubscription",
b||!0):this.set("userSubscription",!1);var e={thread:this.id};if(b)e.email=b;else if(!a&&typeof d==="string")e.email=d;DISQUS.api.call("threads/"+(a?"subscribe.json":"unsubscribe.json"),{data:e,method:"POST"})}},relatedIds:function(){var a=this.get("forum");_.isObject(a);return{forum:this.get("forum"),thread:this.id}},twitterText:function(a){var a=140-(a.length+1),b=DISQUS.next.utils.htmlDecode(this.get("title"));return b=DISQUS.next.utils.niceTruncate(b,a)},url:function(){var a=this.get("url")||
this.get("link");if(!a&&this.currentUrl)a=this.currentUrl;return a}}),a=n.extend({defaults:_.extend({postsInInterval:0,posts:0,topPost:null},n.prototype.defaults)}),o=Backbone.Model.extend({defaults:function(){return{createdAt:moment().format(DISQUS.time.ISO_8601),dislikes:0,isApproved:!0,isDeleted:!1,isEdited:!1,isFlagged:!1,isHighlighted:!1,isRealtime:!1,isImmediateReply:!1,isMinimized:null,hasMedia:!1,message:null,raw_message:null,likes:0,media:[],parent:null,points:0,depth:0,userScore:0}},initialize:function(){this.votes=
new d.VoteCollection;this.usersTyping=new d.TypingUserCollection},set:function(a,d,e){if(a&&typeof a!=="string"&&a.author)this.author=new b(m,a.author),delete a.author;return Backbone.Model.prototype.set.call(this,a,d,e)},messageText:function(){var a=this.get("message");return _.strip(a)},relatedIds:function(){var a=this.get("forum");if(_.isObject(a))a=a.id;var b=this.get("thread");if(_.isObject(b))b=b.id;return{forum:a,thread:b,post:this.id}},twitterText:function(a){var b=140,d;d=this.author.get("name")||
this.author.get("username");b-=d.length+3;b-=a.length+1;b-=2;a=this.messageText();a=DISQUS.next.utils.niceTruncate(a,b);return'"'+a+'" \u2014 '+d},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);a.isMinimized=this.get("isMinimized")===!1?!1:!this.get("isApproved");if(this.author)a.author=this.author.toJSON();a.relativeCreatedAt=this.getRelativeCreatedAt();a.formattedCreatedAt=this.getFormattedCreatedAt();a.cid=this.cid;return a},getFormattedCreatedAt:function(){var a=this.get("createdAt");
if(!a)return null;a=DISQUS.time.assureTzOffset(a);return moment.utc(a,DISQUS.time.ISO_8601).local().format("LLLL")},validate:function(a){if(!this.id&&!a.id){if(_.isString(a.raw_message)){if(a.raw_message==="")return h("Comments can't be blank.");if(a.raw_message.length<2)return h("Comments must have at least 2 characters.")}if(a.author_email===""&&a.author_name==="")return h("Please sign in or enter a name and email address.");else if(a.author_email===""||a.author_name==="")return h("Please enter both a name and email address.");
if(_.isString(a.author_email)&&!e.validateEmail(a.author_email))return h("Invalid email address format.")}},report:function(){this.set("isFlagged",!0);DISQUS.api.call("posts/report.json",{data:{post:this.id},method:"POST"})},_vote:function(a,b){var d=a-b,e={likes:this.get("likes"),dislikes:this.get("dislikes"),points:this.get("points")};if(d===0)return d;a>0?(e.likes+=a,e.dislikes+=b):a<0?(e.dislikes-=a,e.likes-=b):b>0?e.likes-=b:e.dislikes+=b;e.points+=d;this.set(e);return d},vote:function(a){var b=
this;b._vote(a,b.get("userScore"))!==0&&(b.set("userScore",a),DISQUS.api.call("posts/vote.json",{data:{post:b.id,vote:a},method:"POST",success:function(d){b.votes.add({id:d.response.id,score:a},{merge:!0})}}))},_delete:function(){this.set({isApproved:!1,isDeleted:!0});DISQUS.api.call("posts/remove.json",{data:{post:this.id},method:"POST"})},spam:function(){this.set({isApproved:!1,isDeleted:!0,isSpam:!0});this.trigger("spam");DISQUS.api.call("posts/spam.json",{data:{post:this.id},method:"POST"})},
_create:function(a,b){var d=this,e=a.attributes,j={thread:e.thread,message:e.raw_message};if(e.recaptcha_challenge_field)j.recaptcha_challenge_field=e.recaptcha_challenge_field,j.recaptcha_response_field=e.recaptcha_response_field;if(e.parent)j.parent=e.parent;if(e.author_name)j.author_name=e.author_name,j.author_email=e.author_email;DISQUS.api.call("posts/create.json",{data:j,method:"POST",success:function(a){d.set(a.response);b.success&&b.success()},error:b.error})},_update:function(a,b){var d=
this,e=a.attributes;DISQUS.api.call("posts/update.json",{data:{post:e.id,message:e.raw_message},method:"POST",success:function(a){d.set(a.response);b.success&&b.success()},error:b.error})},_read:function(a,b){var d=this,b=b||{};DISQUS.api.call("posts/details.json",{data:{post:d.id},method:"GET",success:function(a){d.set(a.response);b.success&&b.success()},error:b.error})},sync:function(a,b,d){var d=d||{},e=d.error;if(e)d.error=function(a){e(JSON.parse(a.responseText||"{}"))};switch(a){case "create":this._create(b,
d);break;case "update":this._update(b,d);break;case "delete":this._delete();break;case "read":this._read(b,d)}}});_.extend(o.prototype,f);b.addType("Post",o);var k=Backbone.Model.extend({defaults:{userId:null,message:null,parentId:null,immedReply:!1,createdAt:void 0},getVisibleParent:function(a){for(var b=this,d;b.get("parentId");){if(d=a.posts.get(b.get("parentId")))return d;b=a.queue.get(b.get("parentId"));if(!b)break}return null},toPost:function(a){var d=a.posts.get(this.get("parentId")),d=d?d.get("depth")+
1:0,d=new b(o,{id:this.id,thread:a.id,message:this.get("message"),parent:this.get("parentId"),depth:d,createdAt:this.get("createdAt"),isRealtime:!0,isImmediateReply:this.get("immedReply")});d.author=a.users.get(this.get("userId"));return d}}),l=Backbone.Model.extend({defaults:{typing:!0},initialize:function(){this.createdAt=moment()}}),t=Backbone.Model.extend({defaults:{about:null,avatar:{cache:DISQUS.urls.media+"/images/noavatar92.png",permalink:DISQUS.urls.media+"/images/noavatar92.png"},connections:{},
email:null,emailHash:null,isAnonymous:!0,isFollowedBy:!1,isFollowing:!1,joinedAt:null,name:null,profileUrl:null,url:null,username:null,numPosts:null,numFollowing:null,numFollowers:null,numLikesReceived:null},hasValidAvatar:function(a){if(!a)a=this.attributes;return(a=a.avatar)&&a.cache},validate:function(a){if(!this.hasValidAvatar(a))return"None of the avatar related properties can be null, undefined or empty on User models."},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments);
a.thread={};if(!this.hasValidAvatar())a.avatar=this.defaults.avatar;return a}}),s=t.extend({idAttribute:"emailHash"});b.addType("AnonUser",s);var m=t.extend({validate:function(a){if(!a.display_name)return h("Please enter your name.");if(!a.email)return h("Please enter an email address.");if(!e.validateEmail(a.email))return h("Invalid email address.");if(this.isNew()){if(!a.password)return h("Please enter the password.");if(a.password.length<m.MIN_PASSWORD_LEN)return h("Password must have at least 6 characters.")}},
fetch:function(a){var b=this,a=a||{},d={};if(b.id)d.user=b.id;else if(b.get("username"))d.user="username:"+b.get("username");return DISQUS.api.call("users/details.json",{data:d,success:function(d){d=d.response;b.set(d);a.success&&a.success(d);a.complete&&a.complete(d)},error:function(b){a.error&&a.error(b);a.complete&&a.complete(b)}})},register:function(a){var b=this,a=a||{};DISQUS.api.call("internal/users/register.json",{secure:!0,data:this.toRegisterJSON(),method:"POST",success:function(d){b.set(d.response);
a.success&&a.success(d)},error:a.error})},toRegisterJSON:function(){return _.pick(this.toJSON(),"display_name","email","password")},isSession:function(a){return a.user.id===this.id},isEditable:function(a){return this.isSession(a)&&!this.get("remote")},toJSON:function(a){var a=a||{},b=t.prototype.toJSON.call(this),d=this.collection&&this.collection.thread;b.thread.canModerate=!!d&&d.isModerator(this);if(a.session)b.isSession=this.isSession(a.session),b.isEditable=this.isEditable(a.session);return b},
_changeFollowState:function(a){this.set("isFollowing",a);DISQUS.api.call("users/"+(a?"follow":"unfollow")+".json",{data:{target:this.id},method:"POST"})},follow:function(){this._changeFollowState(!0)},unfollow:function(){this._changeFollowState(!1)},toggleFollowState:function(){this._changeFollowState(!this.get("isFollowing"))}},{MIN_PASSWORD_LEN:6});b.addType("User",m);var j=m.extend({defaults:_.extend({numPosts:0},m.prototype.defaults)}),u=Backbone.Model.extend({initialize:function(){this.user=
new b(s)},_eventProxy:function(){this.trigger.apply(this,arguments)},_setProxy:function(){this.user.on("all",this._eventProxy,this)},_clearProxy:function(){this.user&&this.user.off("all",this._eventProxy,this)},_setUser:function(a){this._clearProxy();this.user=a;this._setProxy();this.notifications=new d.NotificationCollection(null,{user:this.user});this.notifications.on("markRead",function(a){this.set("notificationCount",this.get("notificationCount")-a.length)},this);this.trigger("change:id",a)},
isRegistered:function(){return this.user instanceof m},isAnonymous:function(){return this.user instanceof s},fetch:function(a){var a=a||{},d={};d["_"+(new Date).getTime()]=1;return DISQUS.api.call("users/details.json",{data:d,success:_.bind(function(d){d=d.response;d.id&&this._setUser(new b(m,d));a.success&&a.success(d);a.complete&&a.complete(d)},this),error:_.bind(function(b){a.error&&a.error(b);a.complete&&a.complete(b)},this)})}}),w=function(){var a=u.extend({defaults:{canReply:!0,canModerate:!1,
discoveryVariant:null,mustVerifyEmail:!1,isReadOnly:!1,audienceSyncVerified:!1,notificationCount:null},toJSON:function(){var a=this.user.toJSON.apply(this.user,arguments);a.thread.canReply=this.get("canReply");if(!a.thread.canModerate)a.thread.canModerate=this.get("canModerate");return a},needsAudienceSyncAuth:function(a){return a.get("settings").audienceSyncEnabled&&this.isRegistered()&&!this.get("audienceSyncVerified")},fetch:function(a){var d=this;if(d._request)d._request.abort(),d._request=null;
var a=a||{thread:{}},e={thread:a.thread.id,post:a.thread.posts.pluck("id")};if(a.discovery)e.discovery=a.discovery;e["_"+(new Date).getTime()]=1;d._request=DISQUS.api.call("embed/threadDetails.json",{data:e,success:function(e){var e=e.response,j={};e.user&&_.extend(j,e.user,{votes:e.votes});d.set(e.session);d.set("discoveryVariant",e.discovery);j.id&&(d._setUser(new b(m,j)),a.thread.users.add(d.user),e.thread&&(a.thread.set("userScore",e.thread.userScore),a.thread.set("userSubscription",e.thread.userSubscription)));
a.success&&a.success(e);d.trigger("identify",d)},error:function(b){a.error&&a.error(b)},complete:function(b){d._request=null;a.complete&&a.complete(b)}});return d._request},logout:function(){var a=this;DISQUS.api.call("internal/users/logout.json",{method:"POST",success:function(){a._setUser(new b(s))}})}}),d;return{get:function(){return d=d||new a},setDefaults:function(b){if(d)throw Error("Session defaults cannot be changed after a session instance is created!");a.defaults=_.extend(a.prototype.defaults,
b);return a.defaults},forget:function(){d=null}}}(),v=Backbone.Model.extend({defaults:{score:0}}),E=Backbone.Model.extend({defaults:{score:0}}),z=Backbone.Model.extend({defaults:function(){return{object:{},type:"",createdAt:moment().format(DISQUS.time.ISO_8601)}},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);a.relativeCreatedAt=this.getRelativeCreatedAt();return a}});_.extend(z.prototype,f);var C=Backbone.Model.extend({defaults:function(){return{sender:"",timestamp:moment().valueOf(),
type:0,formatted:"",theme:"",createdAt:null,post:null}},set:function(a,b){if(a&&typeof a!=="string"&&a.post)this.post=new o(a.post),delete a.post;return Backbone.Model.prototype.set.call(this,a,b)},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);if(this.post)a.post=this.post.toJSON();a.relativeCreatedAt=this.getRelativeCreatedAt();return a}});_.extend(C.prototype,f);f=Backbone.Model.extend({defaults:{enabled:!1}});return{UniqueModel:b,Forum:g,Thread:n,TopThread:a,Post:o,QueuedPost:k,
TypingUser:l,User:m,AnonUser:s,Session:w,BaseSession:u,TopUser:j,Vote:v,ThreadVote:E,Notification:C,ActivityItem:z,Switch:f}});
DISQUS.define("next.collections",function(){var b=DISQUS.use("next.models"),d=Backbone.Collection.extend({model:b.ThreadVote}),e=Backbone.Collection.extend({model:_.bind(b.UniqueModel,{},b.User),initialize:function(a,b){Backbone.Collection.prototype.initialize.apply(this,arguments);this.thread=b&&b.thread}}),h=Backbone.Collection.extend({model:b.Vote}),g=Backbone.Collection.extend({PER_PAGE:10,initialize:function(a,b){b=b||{};this.cursor=b.cursor||{}},fetch:function(a){a=a||{};a.data=_.defaults(a.data||
{},{cursor:a.cursor||"",limit:this.PER_PAGE});return Backbone.Collection.prototype.fetch.call(this,a)},more:function(a){function b(a){e.push(a)}var d=this,a=a||{};if(this.cursor.hasNext){var e=[];this.on("add",b);this.fetch(_.extend({},a,{add:!0,remove:!1,cursor:this.cursor.next,success:function(){d.trigger("add:many",e,d,a);d.off("add",b);a.success&&a.success()}}))}else a.error&&a.error()},parse:function(a){this.cursor=a.cursor;return Backbone.Collection.prototype.parse.call(this,a)}}),f=g.extend({model:b.Notification,
url:DISQUS.api.getURL("messagesx/list"),initialize:function(a,b){this.user=b.user;g.prototype.initialize.apply(this,arguments)},markRead:function(){var a=this.getUnread();if(a.length){var b=_.pluck(a,"id");DISQUS.api.call("messagesx/markRead.json",{data:{messages:b},method:"POST"});_.invoke(a,"set","isRead",!0);this.trigger("markRead",b)}},getUnread:function(){return this.filter(function(a){return!a.get("isRead")})}}),n=g.extend({PER_PAGE:50,model:_.bind(b.UniqueModel,{},b.Post),url:DISQUS.api.getURL("threads/listPostsThreaded"),
initialize:function(a,b){g.prototype.initialize.apply(this,arguments);this.thread=b.thread;this.order=b.order},fetch:function(a){a=a||{};a=_.extend(a,{data:{limit:this.PER_PAGE,thread:this.thread.id,forum:this.thread.get("forum"),order:this.order}});return g.prototype.fetch.call(this,a)}}),a=Backbone.Collection.extend({model:b.QueuedPost,initialize:function(a,b){var d=this;d.thread=b.thread;d.counters={comments:0,replies:{}};d.on("add",function(a){var b=a.getVisibleParent(d.thread),e=d.counters.replies;
b?(e[b.id]=(e[b.id]||0)+1,b.id==a.get("parentId")&&a.set("immedReply",!0)):d.counters.comments+=1})},comparator:function(a){return parseInt(a.id,10)},isDescendant:function(a,b){var c;var d=a.get("parentId"),d=d?this.get(d):null,e={};for(_.each(b,function(a){e[a]=!0});d;){if(e[d.get("id")]===!0)return!0;c=(d=d.get("parentId"))?this.get(d):null,d=c}return!1},drain:function(a){function b(a){var d=[];e.each(function(a){a.get("parentId")===null&&d.push(a.get("id"))});e.reset(e.filter(function(b){if(b.get("parentId")!==
null&&!e.isDescendant(b,d))return b;a(b)}));e.counters.comments=0}function d(b){var f=[],h;h=e.filter(function(b){var d=b.getVisibleParent(e.thread);if(!d||d.get("id")!=a)return b;f.push(b)});f=_.sortBy(f,function(a){return parseInt(a.get("id"),10)});_.each(f,function(a){b(a)});e.reset(h);e.counters.replies[a]=0}var e=this;return(a?d:b)(function(a){e.thread.posts.add(a.toPost(e.thread))})}}),o=Backbone.Collection.extend({model:b.Switch,parse:function(a){return _.map(a,function(a,b){return{id:b,enabled:a}})},
enabled:function(a){return(a=this.get(a))?a.get("enabled"):!1}}),k=Backbone.Collection.extend({models:b.TypingUser,initialize:function(){var a=this;a.gc=null;a.on("add remove reset",function(){var b=a.count();if(b>0&&a.gc===null)a.gc=setInterval(_.bind(a.cleanup,a),6E4);else if(b<=0&&a.gc!==null)clearInterval(a.gc),a.gc=null},a)},count:function(){var a=0;this.each(function(b){a+=b.get("typing")?1:-1});return a},cleanup:function(){var a=moment();this.reset(this.filter(function(b){return b.createdAt.diff(a,
"minutes")>5}))}}),l=Backbone.Collection.extend({model:b.ActivityItem,url:DISQUS.api.getURL("users/listActivity"),initialize:function(a,b){this.user=b.user;this.include=b.include||null},fetch:function(a){var a=a||{},b={user:"username:"+this.user.get("username")};if(this.include)b.include=this.include;a.data=_.defaults(a.data||{},b);Backbone.Collection.prototype.fetch.call(this,a)}}),t=g.extend({model:_.bind(b.UniqueModel,{},b.Post),url:DISQUS.api.getURL("users/listPostActivity")}),s=Backbone.Collection.extend({model:b.TopThread,
url:DISQUS.api.getURL("threads/listPopular"),initialize:function(a,b){this.forum=b.forum;this.limit=b.limit},set:function(a,b){b.parse&&(a=this.parse(a,b),delete b.parse);_.isArray(a)||(a=a?[a]:[]);a=_.reject(a,function(a){return a.title.match(/^http/i)});Backbone.Collection.prototype.set.call(this,a,b)},fetch:function(a){Backbone.Collection.prototype.fetch.call(this,_.extend({data:{forum:this.forum,limit:this.limit,interval:"7d",with_top_post:!0}},a))}}),b=Backbone.Collection.extend({model:b.TopUser,
url:DISQUS.api.getURL("forums/listMostActiveUsers"),initialize:function(a,b){this.forum=b.forum;this.limit=b.limit;this.discardLowRep=b.discardLowRep},fetch:function(a){Backbone.Collection.prototype.fetch.call(this,_.extend({data:{forum:this.forum,limit:this.limit}},a))},parse:function(a){if(!this.discardLowRep)return a.response;return _.filter(a.response,function(a){if(parseFloat(a.rep)>0.7)return a})}}),m=e.extend({LIMIT:50,url:DISQUS.api.getURL("posts/listUsersVotedPost"),initialize:function(a,
b){this.postId=b.postId;this.threadId=b.threadId},fetch:function(a){Backbone.Collection.prototype.fetch.call(this,_.extend({data:{post:this.postId,thread:this.threadId,vote:1,limit:this.LIMIT}},a))}});return{PaginatedCollection:g,UserCollection:e,PostCollection:n,TypingUserCollection:k,TopUserCollection:b,TopThreadCollection:s,VoteCollection:h,ThreadVoteCollection:d,ActivityCollection:l,PostActivityCollection:t,NotificationCollection:f,QueuedPostCollection:a,SwitchCollection:o,UpvotersUserCollection:m}});
DISQUS.define("next.views",function(){function b(c){return(c=c&&c.match(/discovery\-([\w\-]+)/))&&c[1]}function d(c){return function(a){a&&a.preventDefault&&a.preventDefault();c.apply(this,arguments)}}function e(c,a){var b="[data-action^="+a+"]",d=$(c),d=d.is(b)&&d||d.closest(b);return(d.attr("data-action")||":").split(":")[1]}var h=DISQUS.use("next.models"),g=DISQUS.use("next.collections"),f=DISQUS.use("next.utils"),n=DISQUS.use("next.realtime"),a=DISQUS.use("Bus"),o=DISQUS.use("JSON"),k=DISQUS.strings.get,
l,t={_getShortUrl:function(c){var a=this,b=this._shareUrl(),d=b,b=_.extend({url:b,source:"disqus_embed_next"},this.model.relatedIds());DISQUS.api.call("shortener/create.json",{method:"POST",data:b,timeout:5E3,success:function(c){if(c.code===0)d=c.response.url},complete:function(){c.call(a,d)}})},_shareWaitPopup:function(c){return window.open(DISQUS.urls.loading,"_blank",c||"width=550,height=520")},share:function(c){this.sharers[c].call(this)},sharers:{twitter:function(){var c=this._shareWaitPopup();
this._getShortUrl(function(a){c.location=DISQUS.serialize("https://twitter.com/intent/tweet",{url:a,text:this.model.twitterText(a)})})},facebook:function(){var c=this._shareWaitPopup("width=655,height=352");this._getShortUrl(function(a){c.location=DISQUS.serialize("https://www.facebook.com/sharer.php",{u:a})})}}},s={alert:function(c,a){a?_.isString(a)&&(a={type:a}):a={};this.dismissAlert();var b=this._alert=new O(_.extend({message:c},a));this.updateDom(function(){this.el.parentNode.insertBefore(b.render().el,
this.el)},this);return b},dismissAlert:function(){this._alert&&this._alert.dismiss()}},m=Backbone.View.extend({events:{"click [data-action^=auth\\:]":"handleAuth","click [data-action=verify-email]":"verifyEmail","click [data-action=audiencesync]":"audienceSync","click [data-action=profile]":"handleShowProfile","click [data-action=sort]":"handleSort","click [data-action=close-thread]":"closeThread","click [data-action=open-thread]":"openThread","click [data-action=debug]":"renderDebugInfo","click [data-action=toggle-compose]":function(){this.form.show();
this.form.focus()},"click [data-action=back]":"handleBackButton"},STREAMING_MAX_VISIBLE:250,MEDIA_PERSISTED_WIDTHS:[320,480,600,800],MAX_MEDIA_HEIGHT:480,initialize:function(c){l=this;c=c||{};c=c.jsonData||{};this.initialData=c.response||{};this.profileWindowName=_.uniqueId("disqus_");this.isFullscreen=window.parent===window;if(f.extract(c,"response.forum.id"))DISQUS.urls.moderate=f.updateURL(DISQUS.urls.moderate,{hostname:c.response.forum.id+"."});this.theme=f.extract(this.initialData,"theme.base")||
{};h.Session.setDefaults(this.initialData.session);this.session=h.Session.get();this.bindSessionEvents();this.forum=new h.Forum;this.forum.set(this.initialData.forum);this.thread=new h.Thread(this.initialData.thread,{forum:this.forum,postCursor:c.cursor,moderators:(this.initialData.thread||{}).moderators,order:c.order});this.posts=this.thread.posts;this.postsToAppend=[];this.postsToPrepend=[];this.switches=new g.SwitchCollection(_.map(DISQUS.config.switches,function(c){return{id:c,enabled:!0}}));
this.states={templateReady:!1,realtimeIndicatorsCreated:!1,ravenConfigured:!1,inViewport:!1,streamingPaused:!1};this.forum.get("settings").backplaneEnabled&&this.enableBackplane();a.on("window.inViewport",function(){this.states.inViewport=!0;this.trigger("inViewport")},this);a.on("window.scrollOffViewport",function(){this.states.inViewport=!1},this);c=_.bind(this.bootstrap,this);if(window.parent!==window||window.opener)a.on("init",c);else _.defer(c);a.sendHostMessage("ready")},_switchesReady:function(){if(!this.states.ravenConfigured&&
this.switches.enabled("next_raven"))Raven.config({servers:["http://disqus.com/raven/api/store/"],logger:"javascript.next",ignoreErrors:["Script error."]}),window.onerror=Raven.process,DISQUS.api.defaults({error:function(c){Raven.captureMessage({name:"API call failed.",message:c})}}),this.states.ravenConfigured=!0;_.invoke(this.postViews,"manageMessageHeight");if(!this.switches.enabled("next_lazy_embed")||this.states.inViewport)this.fetchSession();else this.on("inViewport",this.fetchSession,this);
var c=this.initLinkAffiliator();this.switches.enabled("next_track_links")&&(this.events["click a"]=_.wrap(f.logLinkClick,function(a,b){var d=!c||!$(b.currentTarget).is("[rel=nofollow]");return a(b,d)}),this.delegateEvents())},_templateReady:function(){window.Handlebars.lounge.templates();this.updateModeratorText();this.states.templateReady=!0;this.renderLayout();this.once("postsRendered",function(){var c=f.getPageHeight();a.sendHostMessage("mainViewRendered",{height:c});this._lastHeight=c;this.initRealtime()},
this);_.defer(_.bind(this.trigger,this,"templateReady"))},enableBackplane:function(){this.backplaneCredentialsReady=!1;this.events["click [data-action=logout]"]=function(c){if(this.backplaneCredentialsReady)c.preventDefault(),a.sendHostMessage("backplane.invalidate",{redirectUrl:DISQUS.urls.logout});else return!0};this.session.on("identify",function(){if(this.backplaneCredentialsReady&&!this.session.isRegistered())a.sendHostMessage("backplane.invalidate"),this.backplaneCredentialsReady=!1,DISQUS.api.headers({Authorization:null})},
this);a.on("login",function(c){c.backplane!==null&&(this.setBackplaneHeaders(c.backplane),this.fetchSession())},this);a.sendHostMessage("loadBackplane")},setBackplaneHeaders:function(c){c="Backplane "+o.stringify({provider:"janrain",message_id_url:c.messageUrl,channel_name:c.channel,forum_id:this.forum.id});this.backplaneCredentialsReady=!0;DISQUS.api.headers({Authorization:c})},bootstrap:function(c){var i=this,d={};i.config=c=c||{};this.discoveryOverride=b(c.parentWindowHash);if(c.apiKey)d["X-Disqus-Publisher-API-Key"]=
c.apiKey;if(c.remoteAuthS3)d["X-Disqus-Remote-Auth"]=c.remoteAuthS3;_.isEmpty(d)||DISQUS.api.headers(d);c.anchorColor&&function(){var a=f.escapeColor(c.anchorColor);f.addStylesheetRules([[".publisher-anchor-color a",["color",a,!0]],["a.publisher-anchor-color",["color",a,!0]],[".publisher-anchor-hover a:hover",["color",a,!0]],["a.publisher-anchor-hover:hover",["color",a,!0]],[".active .publisher-nav-color:after",["background",a,!0]],[".media-preview .active.publisher-border-color",["border-color",
a,!0]]])}();this.isFullscreen||f.injectBaseElement(c.referrer);if(c.referrer)i.thread.currentUrl=c.referrer;if(c.width)document.body.style.width=c.width+"px";if(c.permalink)a.once("embed.rendered",_.bind(i.scrollToPost,i,c.permalink,{highlight:!0}));if(c.sso)DISQUS.templateGlobals.sso=c.sso;this.loadTheme(c);i.once("templateReady",i.findClosestThumbnailSize,i);i.once("templateReady",i.renderForm,i);i.once("templateReady",i.updatePostCount,i);i.once("templateReady",i.initCommunity,i);i.once("templateReady",
i.initUserMenu,i);i.once("templateReady",i.initThreadVotes,i);i.once("templateReady",i.initThreadShareMenu,i);i.once("templateReady",i.initThreadSubscribe,i);i.once("templateReady",i.renderStreamingToggle,i);i.renderBindings([i.thread,"change:likes",i.updateThreadVotes],[i.thread,"change:userScore",i.updateThreadUserScore],[i.thread,"change:posts",i.updatePostCount],[i.thread.posts,"reset",i.redrawPosts],[i.thread.posts,"add",i.addPosts],[i.thread.posts,"remove",i.removePost],[i.thread.posts,"reset add",
i.toggleLoadMorePosts],[i.thread.posts,"reset add",i.toggleNoPosts],[i.session,"change:id",i.updateThreadSessionData],[i.session,"change:id",i.initDashboard]);i.on("scrollOffViewport",function(){i.states.realtimeIndicatorsCreated&&i.currentSection==="conversation"&&(a.sendHostMessage("realtime.hideNorth"),a.sendHostMessage("realtime.hideSouth"))});i.on("scroll",function(c){i.position=c;if(i.currentSection==="conversation")i.conversationPosition=c});d=_.bind(i.processDeferredImages,i);i.on("scroll",
d);$(window).on("resize scroll",_.debounce(d,100));i.on("domReflow",function(){i.deferredImages=null;i.processDeferredImages()});a.on("window.resize",i.processDeferredImages,i);i.on("scroll",i.handleRealtimeScroll,i);a.on("window.hashchange",function(c){i.discoveryOverride=b(c);if(i.discoveryOverride)return i.fetchSession();(c=c&&c.match(/comment\-([0-9]+)/))&&i.scrollToPost(c[1],{highlight:!0})});a.on("window.scroll",function(c){i.trigger("scroll",c)});a.on("window.scrollOffViewport",function(){i.trigger("scrollOffViewport")});
a.on("window.resize",i.resize,i);a.on("realtime.click",i.handleRealtimeClick,i);i.thread.queue.on("add reset",i.toggleRealtimeNotifications,i);i.on("postsRendered",i.toggleRealtimeNotifications,i);i.posts.reset(this.initialData.posts);var e=$("body");i.getTypeface()==="serif"&&e.addClass("serif");i.getColorScheme()==="dark"&&e.addClass("dark");i.bindBusListeners();_.delay(function da(){i.postViews&&!(_.size(i.postViews)<1)&&(_.invoke(i.postViews,"updateRelativeTime"),_.delay(da,6E4))},6E4);i.currentSection=
"conversation";i.thread.on("create",function(c){a.sendHostMessage("posts.create",c.toJSON())});var d=$(window),F=e.width(),h=_.debounce(function(){var c=e.width();F!=c&&i.postViews&&(F=c,_.each(i.postViews,function(c){c.manageMessageHeight()}))},50);d.on("resize",h);i.initialized=!0;i._switchesReady()},bindBusListeners:_.once(function(){var c=this;a.on("!auth:success",function(a){a&&(a.sessionId&&DISQUS.api.headers({"X-Sessionid":a.sessionId}),a.message&&c.alert(a.message,{type:"info"}),a.logEvent&&
l.trigger("uiAction:"+a.logEvent));this.fetchSession()},this);a.on("!audiencesync:grant",function(){this.session.set("audienceSyncVerified",!0)},this)}),initLinkAffiliator:function(){if(this.switches.enabled("enable_link_affiliation")&&f.extract(this,"initialData.forum.settings.linkAffiliationEnabled")&&!this.isHttps()&&!this.initLinkAffiliatorCalled){this.initLinkAffiliatorCalled=!0;var c=f.extract(this,"initialData.forum.pk");if(_.isNumber(c)){var b=new P({el:document.body});a.once("affiliationOptions",
function(c){c&&_.isNumber(c.timeout)&&b.trigger("options.timeout",c.timeout)});a.sendHostMessage("loadLinkAffiliator",{clientUrl:DISQUS.urls.linkAffiliatorClient,apiUrl:"//links.services.disqus.com/api",key:"cfdfcf52dffd0a702a61bad27507376d",id:c});return!0}}},loadTheme:function(c){this.language=c=c.language||this.initialData.forum.language||"en";var a=_.bind(this._templateReady,this);c==="en"?a():curl(["js!"+DISQUS.urls.translations+"/"+c+".js"]).then(a,function(c){a();DISQUS.log(c)})},bindSessionEvents:_.once(function(){this.session.on("change:isReadOnly",
function(){this.session.get("isReadOnly")&&this.alert(k("The Disqus comment system is temporarily in maintenance mode. You can still read comments during this time, however posting comments and other actions are temporarily delayed."))},this);this.session.on("identify change:audienceSyncVerified",function(){this.session.get("audienceSyncVerified")&&a.sendHostMessage("session.identify",this.session.user.id)},this);this.session.on("change:discoveryVariant",this.initDiscovery,this)}),fetchSession:function(){var c=
{thread:this.thread};if(this.switches.enabled("discovery_next:override")&&this.discoveryOverride)c.discovery=this.discoveryOverride;return this.session.fetch(c)},initRealtimeIndicators:function(){if(!this.switches.enabled("disable_realtime_indicators")&&!this.states.realtimeIndicatorsCreated){var c={contents:DISQUS.renderBlock("realtimeIndicator",{orientation:"north"})},b={contents:DISQUS.renderBlock("realtimeIndicator",{orientation:"south"})};a.sendHostMessage("realtime.init",{north:c,south:b});
this.states.realtimeIndicatorsCreated=!0}},insertStreamingComments:_.throttle(function(){var c=this.thread.queue;c.drain();_.each(c.counters.replies,function(a,b){c.drain(b)})},1E3),getTypeface:function(){var c=this.forum.get("settings");return c.typeface==="auto"?this.config.typeface:c.typeface},getColorScheme:function(){var c=this.forum.get("settings");return c.colorScheme==="auto"?this.config.colorScheme:c.colorScheme},updateModeratorText:function(){var c=this.forum.get("settings");if(c.moderatorText)DISQUS.strings.translations.Mod=
c.moderatorText},handleRealtimeScroll:function(c){if(this.states.inViewport&&this.states.realtimeIndicatorsCreated&&this.currentSection==="conversation"){var b=_.union([this.queueView],_.values(this.postViews)),d=0,e=0;_.each(b,function(a){if(a&&!a.getDirection)a=a.queueView;if(a&&!(a.options.count<=0)){var b=a.getDirection(c);b===1?d+=a.options.count:b===-1&&(e+=a.options.count)}});var b="realtime.hideNorth",f;d>0&&(b="realtime.showNorth",f=DISQUS.renderBlock("realtimeIndicatorText",{num:d,orientation:"north"}));
a.sendHostMessage(b,f);b="realtime.hideSouth";f=void 0;e>0&&(f=DISQUS.renderBlock("realtimeIndicatorText",{num:e,orientation:"south"}),b="realtime.showSouth");a.sendHostMessage(b,f)}},handleRealtimeClick:function(c){var b=this;a.sendHostMessage("realtime.hide"+(c==="north"?"North":"South"));var d=_.union([b],_.toArray(b.postViews)),e,d=_.filter(d,function(a){a=a.queueView;if(!a||a.options.count<=0)return!1;var d=c==="north"?1:-1;if(a.getDirection(b.position)!==d)return!1;return!0}),d=_.sortBy(d,function(c){if(c===
b)return 0;return c.offset.top});e=c==="north"?_.last(d):_.first(d);d=e.queueView;e=e===b?0:e.offset.top-100;d.drainHandler();m.getInstance().once("domReflow",_.bind(a.sendHostMessage,a,"scrollTo",{top:e}))},toggleRealtimeNotifications:function(){var c=this,b=c.thread.queue;c.updateDom(function(){_.defer(function(){a.sendHostMessage("fakeScroll")});if(!b.length)return void $("[data-role=realtime-notification]").hide();if(c.thread.get("hasStreaming"))return void c.insertStreamingComments();if(b.counters.comments){var d=
c.queueView||new G({model:c.thread,el:c.$el.find("button[data-role=realtime-notification]")});c.queueView=d;d.setCount(b.counters.comments);d.render()}_.each(b.counters.replies,function(a,b){var i=c.thread.posts.get(b);if(i){var d=c.postViews[i.cid];if(d){var e=d.queueView;if(!e)e=new Q({thread:c.thread,postView:d,model:i,el:d.$el.find("[data-role=realtime-notification\\:"+b+"] a")}),d.queueView=e;e.setCount(a);e.render()}}})})},renderDebugInfo:d(function(){if(this.session.user.get("isGlobalAdmin")){for(var c=
[],a=0,b=this.switches.models.length;a<b;a++)this.switches.models[a].attributes.enabled&&c.push(this.switches.models[a].id);var d=new R({Shortname:this.thread.get("forum"),"Thread ID":this.thread.get("id"),"Thread slug":this.thread.get("slug"),"Anchor color":f.escapeColor(this.config.anchorColor),Switches:c.join(", ")});d.render();this.updateDom(function(){var c=document.body;c.insertBefore(d.el,c.firstChild)})}}),scrollToPost:function(c,b){var b=b||{},d=this;if(d.currentSection!=="conversation")b.force=
!0;d.mainNav.navTo("conversation");var e=d.$el.find("#post-"+c);e.length?(b.highlight&&(d.$el.find(".post-content.target").removeClass("target"),e.find(".post-content").first().addClass("target")),a.sendHostMessage("scrollTo",{top:e.offset().top+(b.padding||0),force:b.force||null})):DISQUS.api.call("posts/getContext.json",{method:"GET",data:{post:c},success:function(e){e=_.filter(e.response,function(c){return c.thread==d.thread.get("id")});e.length!==0&&(_.each(e,function(c){c=new h.UniqueModel(h.Post,
c);c.requestedByPermalink=!0;d.thread.posts.add(c)}),a.once("embed.resized",_.bind(d.scrollToPost,d,c,b)))}})},updateThreadSessionData:function(c){c&&(c.get("thread")&&this.thread.set(c.get("thread")),(c=c.get("votes"))&&typeof c==="object"&&_.each(c,function(c,a){var b=this.posts.get(a);b&&b.set("userScore",c)},this))},initDashboard:function(){var c=$("#main-nav [data-nav=dashboard]");if(this.session.isAnonymous())return c.hide();c.show();this.notificationCount=new I({el:c.find("[data-role=notification-count]")[0],
session:this.session,max:99});this.notificationCount.render();this.session.on("change:notificationCount",function(){this.session.get("notificationCount")<=0&&this.notificationCount.remove()},this);this.dashboard=new S({el:"#dashboard",session:this.session,notifications:this.notifications});this.dashboard.render()},initCommunity:function(){this.community=new T({el:document.getElementById("community"),forum:this.forum})},_getLogoutUrl:function(){return this.config.sso&&this.session.user.get("user_type")===
"sso"?this.config.sso.logout:DISQUS.urls.logout},initUserMenu:function(){var c=this.userMenu=new E({el:this.$el.find("[data-role=logout]")[0],session:this.session,thread:this.thread,logoutUrl:this._getLogoutUrl(),referrerUrl:this.config.referrer});this.session.on("change:id",function(){c.logoutUrl=this._getLogoutUrl();c.render()},this);this.thread.on("change:isClosed",this.render,this);c.render()},initThreadShareMenu:function(){this.threadShareMenu=new u({el:$("#thread-share-menu")[0],model:this.thread})},
initDiscovery:function(c,a){function b(){if(!d.states.templateReady)return void l.once("templateReady",b);DISQUS.discovery.init(_.extend({},a,{sourceThread:d.initialData.thread,sourceForum:d.initialData.forum,containerId:"discovery",session:c,sourceThreadUrl:d.thread.currentUrl||document.referrer})).on("resize",d.updateDom,d)}var d=this;if(!d.states.initDiscoveryCalled&&(d.states.initDiscoveryCalled=!0,!d.isFullscreen)){if(!a)return void DISQUS.log("Discovery seems not enabled. Check Gargoyle switches or forum settings.");
curl(["css!"+a.css,"js!"+a.js]).then(function(){window.Handlebars.discovery.templates();b()})}},toggleLoadMorePosts:function(){var c=this.$el.find("#posts [data-role=more]");this.updateDom(function(){this.thread.posts.cursor.hasNext?c.show():c.hide()},this)},isHttps:function(){return window.location.protocol==="https:"},isRealtimeEnabled:function(){var c=moment.unix(this.initialData.lastModified);return!this.thread.get("isClosed")&&(this.switches.enabled("realtime_for_oldies")||moment().diff(c,"days")<=
7)},realtimeHandlers:{Post:function(c){var c=c.data,a=this.thread;if(!this.thread.get("hasStreaming")||!this.states.streamingPaused){if(!c.id)return void DISQUS.logError("RT: no post ID");if(!c.author||!c.author.id)return void DISQUS.logError("RT: no author or author ID");if(!c.author.name||!c.author.email_md5)return void DISQUS.logError("RT: no author name or email hash");if(!c.post||!c.post.message)return void DISQUS.logError("RT: no post message");if(a.posts.get(c.id)||a.queue.get(c.id))return void DISQUS.log("RT: duplicate: ",
c.id);if(c.type!=="approved")return void DISQUS.log("RT: unnaproved: ",c.id);if(c.type===c.type_prev)return void DISQUS.log("RT: Post change message, ignoring for now",c.id);this.thread.incrementPostCount(1);var b=c.post.parent_post.id;if((b=b!=="0"?b:null)&&!a.posts.get(b)&&!a.queue.get(b))return void DISQUS.log("RT: parent is not on this page: ",c.id);var d=c.author.id,e=a.users.get(d);e||(e=new h.UniqueModel(h.User,{id:d,name:c.author.name,emailHash:c.author.email_md5,isAnonymous:c.author.id===
"0"}),c.author.avatar&&e.set("avatar",{cache:c.author.avatar,permalink:c.author.avatar}),a.users.add(e));a.queue.add({id:c.id,userId:e.get("id"),parentId:b,message:c.post.message,createdAt:c.date})}},Vote:function(c){var a=c.data;if(a.id&&a.vote){var b=this.thread.posts.get(a.vote.recipient_post_id);b&&(DISQUS.log("RT: Vote for post ",b.id),c=b.votes.get(a.id),c||(DISQUS.log("RT: Creating new vote with id ",a.id),c=new h.Vote({id:a.id}),b.votes.add(c)),a=b._vote(a.vote.vote,c.get("score")),a!==0&&
c.set("score",a))}},ThreadVote:function(c){var a=c.data,b=this.thread;a.id&&a.vote&&!(this.session.user.id&&a.vote.voter_id==this.session.user.id)&&(c=b.votes.get(a.id),c||(c=new h.ThreadVote({id:a.id}),b.votes.add(c)),a=b._vote(a.vote.vote,c.get("score")),a!==0&&c.set("score",a))},IsTyping:function(c){var a=c.data,b=this.thread;a.thread_id==b.id&&a.post.parent_post.id&&(b=b.posts.get(a.post.parent_post.id))&&(b.usersTyping.get(c.lastEventId)||(!(b.usersTyping.count()<=0)||a.typing)&&b.usersTyping.add(new h.TypingUser({id:c.lastEventId,
typing:a.typing})))}},initRealtime:function(){var c=n.Manager;if(!c.pipe&&this.isRealtimeEnabled()){this.initRealtimeIndicators();var a;if(this.switches.enabled("aggressive_embed_cache"))a=this.initialData.lastModified;c.initialize("thread/"+this.thread.id,a,this.realtimeHandlers,this);var b=0;DISQUS.api.on("call",function(a){a.method!=="POST"||a.secure||(b++,c.pause())});DISQUS.api.on("complete",function(){b<=0||--b||c.resume()})}},renderBindings:function(){var c=this;_.each(arguments,function(a){var b=
a[2];a[0].on(a[1],function(){var a=arguments;if(c.states.templateReady)b.apply(c,a);else c.on("templateReady",function(){b.apply(c,a)})})})},updateDom:function(){var c=_.debounce(function(){this.resize();this.trigger("domReflow")},0);return function(a,b){a&&a.call(b);c.call(this)}}(),initThreadVotes:_.debounce(function(){var c;this.threadVotes&&this.threadVotes.remove();this.threadVotes=c=new w({thread:this.thread,session:this.session});c.on("vote:up",_.bind(this.trigger,this,"uiAction:threadUpvote"));
c.on("vote:down",_.bind(this.trigger,this,"uiAction:threadDownvote"));c.render();this.updateDom(function(){$("#thread-votes").append(c.el)})},200),initThreadSubscribe:function(){this.threadSubscribeButton=new v({session:this.session,thread:this.thread,el:$("#thread-subscribe-button")[0]})},renderStreamingToggle:function(){var c=this;if(c.thread.get("hasStreaming")){var a=$(DISQUS.renderBlock("realtimeToggleButton"));$(a).on("click",d(function(){c.toggleStreamingRealtime()}));c.updateDom(function(){$("#realtime-toggle").empty();
$("#realtime-toggle").append(a[0])})}},toggleStreamingRealtime:function(){var c=$("#realtime-toggle a.btn");this.states.streamingPaused?(this.states.streamingPaused=!1,c.addClass("pause")):(this.states.streamingPaused=!0,c.removeClass("pause"))},updateThreadVotes:function(){$("#thread-votes [data-role=like-count]").text(this.thread.get("likes"))},updateThreadUserScore:function(){var c=this.thread.get("userScore"),a=$("#thread-votes [data-role=vote-button]");a.removeClass("upvoted").removeClass("downvoted");
c>0?a.addClass("upvoted"):c<0&&a.addClass("downvoted")},updatePostCount:function(){$("#post-count").html(DISQUS.renderBlock("postCount",{count:this.thread.get("posts")}))},swapMain:function(c){var b=this,d=this.$el.find("#main-nav [data-nav=conversation]").parent("li");c!=="conversation"?d.attr("data-dropdown","disabled"):_.defer(function(){d.attr("data-dropdown","enabled")});b.updateDom(function(){b.states.realtimeIndicatorsCreated&&c!="conversation"&&(a.sendHostMessage("realtime.hideNorth"),a.sendHostMessage("realtime.hideSouth"));
var d=b[c];d&&!d.isRendered&&(b.freeze(!0),d.on("render:all",_.once(function(){b.freeze(!1)})),d.show());b.$el.find("[data-role=main]").hide();b.$el.find("[data-role=main]#"+c).show();b.prevSection=b.currentSection;b.currentSection=c});b.trigger("uiAction:navigate",c)},returnToConversation:function(){this.mainNav.navTo("conversation");var c=this.conversationPosition,b=c&&c.pageOffset;b&&this.updateDom(function(){_.delay(function(){a.sendHostMessage("scrollTo",{top:b,relative:"window",force:!0})},
100)},this)},setupNavigation:function(){var c=this;c.mainNav=new fa({el:c.$el.find("#main-nav")[0]});c.mainNav.on("nav",function(a){c.updateDom(function(){c.swapMain(a)})})},renderLayout:function(){var c=this;c.isFullscreen&&$(document.documentElement).addClass("fullscreen");var b=$(DISQUS.renderBlock("layout",{thread:c.thread.toJSON(),forum:c.forum.toJSON(),order:c.thread.posts.order,fullscreen:c.isFullscreen})),d=c.$el;b.appendTo(d);c.setupNavigation();d.delegate("[data-action=more-posts]","click",
function(b){return function(d){d.preventDefault();var i=$(d.currentTarget);i.addClass("busy");c.thread[b].more({success:function(){if(b==="posts")c.once("postsRendered",function(){i.removeClass("busy")});else i.removeClass("busy")},error:function(){i.removeClass("busy")}});a.sendHostMessage([b,".paginate"].join(""))}}("posts"));c.updateDom()},renderForm:function(){if(this.thread.get("isClosed"))return void this.alert(k("Comments for this thread are now closed."));if(!this.session.get("canReply"))return void this.session.once("change:id",
this.renderForm,this);var c=this.form=new (this.getPostReplyViewClass())({thread:this.thread,session:this.session});c.render();this.updateDom(function(){c.prependTo($("#form"));c.resize()},this)},getPostReplyViewClass:function(){return this.isFullscreen?L:x},getPostViewClass:function(){return this.isFullscreen?B:A},toggleNoPosts:function(){this.updateDom(function(){this.thread.posts.models.length?$("#no-posts").hide():$("#no-posts").show()},this)},handleShowProfile:d(function(c){this.showProfile($(c.currentTarget).attr("data-user"))}),
handleSort:d(function(c){c=$(c.currentTarget).attr("data-sort");this.$el.find('[data-role="post-sort"]').replaceWith(DISQUS.renderBlock("postSort",{order:c}));this.thread.posts.order=c;this.thread.posts.fetch({reset:!0});f.cookies.create("disqus.order",c);$("#posts [data-role=more]").hide();$("#no-posts").hide();$("#post-list").addClass("loading").empty()}),handleBackButton:function(){window.close()},closeThread:d(function(){this.thread.close({success:_.bind(a.sendHostMessage,a,"reset"),error:_.bind(this.alert,
this,"An error occurred while closing thread. Please try again.","error")})}),openThread:d(function(){this.thread.open({success:_.bind(a.sendHostMessage,a,"reset"),error:_.bind(this.alert,this,"An error occurred while opening thread. Please try again.","error")})}),findClosestThumbnailSize:function(){var c=document.body.offsetWidth;if(this.loadedThumbnailWidth)return this.loadedThumbnailWidth;var a=this.MEDIA_PERSISTED_WIDTHS,b=a.length;this.loadedThumbnailWidth=_.find(a,function(d,e){return e+1===
b||Math.abs(a[e+1]-c)>Math.abs(a[e]-c)})},redrawPosts:function(){var c=this;c.postViews={};c.once("postsRendered",function(){_.each(x.open,function(a,b){var d=c.postViews[b];d&&(d=d.getReplyView(),d.textarea.set(a.textarea.get()),a.isOpen()?d.show():d.hide())})});c.addPosts(c.thread.posts,{clearDom:!0})},createPostView:function(c){var a,b=c.get("parent");b&&(a=(b=this.thread.posts.get(b))&&this.postViews[b.cid]);a=new (this.getPostViewClass())({parent:a,model:c,thread:this.thread,session:this.session,
created:c.created});this.postViews[c.cid]=a;a.render();return a},addPostsIncremental:function(){var c=[],a=!1,b=!1,d=2,e=0,f=0,h;h=window.performance&&window.performance.now?function(){return window.performance.now()}:function(){return new Date};return function ea(){var g=this;if(g.postsShouldClearDom)a=!0,g.postsShouldClearDom=!1,c=[];var k=!!g.postsToAppend.length,j=k?g.postsToAppend:g.postsToPrepend;if(j.length){for(var l=30,n=function(a){a.get("isRealtime")&&(b=!0);c.push(g.createPostView(a))};d>
0;){var m=h(),o=j.splice(0,d);if(!o.length)break;_.each(o,n);m=h()-m;if(m<=0)break;f+=m;l-=m;e+=o.length;d=Math.round(l*e/f)}d=Math.round(Math.max(24*e/f,2));if(!j.length)g.updateDom(function(){var d=$("#post-list");a&&(d.empty(),a=!1);b&&(g.removeOldPosts(),b=!1);d.removeClass("loading");if(c.length){_.each(c,function(c){c.visible=!0});var e=_.groupBy(c,function(c){return!!c.parent});c=[];_.each(e[!0],function(c){c.parent.attachChild(c)});e=_.pluck(e[!1],"el");k?d.append(e):d.prepend(e)}!g.postsToPrepend.length&&
!g.postsToAppend.length&&g.trigger("postsRendered")}),g.nextProcess=null;if(g.postsToPrepend.length||g.postsToAppend.length)g.nextProcess=_.defer(_.bind(ea,g))}else g.nextProcess=null,g.updateDom(function(){$("#post-list").removeClass("loading");this.trigger("postsRendered")},g)}}(),postsShouldBePrepended:function(c){c=c.length&&c[0];return!!c&&(c.created||!c.id||c.get("isRealtime")||c.requestedByPermalink)},hasQueuedPosts:function(){return this.postsToAppend.length||this.postsToPrepend.length},addPosts:_.decorate(Backbone.collectionAddNormalizer(g.PostCollection,
h.Post),function(c,a,b){var d=this;if(b.clearDom)d.postsToAppend=[],d.postsToPrepend=[],d.postsShouldClearDom=!0;if(d.postsShouldBePrepended(c)){var e=[];_.each(c,function(c){var a=c.get("parent");a&&d.thread.posts.get(a)?d.postsToPrepend.push(c):e.push(c)});d.postsToPrepend=e.concat(d.postsToPrepend)}else d.postsToAppend=d.postsToAppend.concat(c);if(!d.nextProcess)d.nextProcess=_.defer(_.bind(d.addPostsIncremental,d))}),calculateImageOffsets:function(){var c=[],a=$("img[data-src]");_.each(a,function(a){var a=
$(a),b=a.offset();(b.top||b.left)&&c.push({offset:b.top,element:a,relatedPost:a.attr("data-post")})});this.deferredImages=c},processDeferredImages:function(){this.deferredImages||this.calculateImageOffsets();var c=this.deferredImages.length;if(c){var a=this.position||{pageOffset:$(window).scrollTop(),height:document.documentElement.clientHeight,frameOffset:{left:0,top:0}},a=a.pageOffset+a.height*2-a.frameOffset.top;if(!(a<0)){for(var b=0;b<c;++b){var d=this.deferredImages[b];if(d.offset<=a){var e=
d.element,f=e.attr("data-src");f&&(d.relatedPost&&(d=_.bind(this.onPostImageReady,this,d),e.on("load",d),e.on("error",d)),e.attr("src",f),e.removeAttr("data-src"))}else break}this.deferredImages=this.deferredImages.slice(b)}}},onPostImageReady:function(c){var a=l.postViews,c=c.relatedPost;a.hasOwnProperty(c)&&a[c].manageMessageHeight();this.updateDom()},showProfile:function(c){Modernizr.sessionstorage&&sessionStorage.setItem("profile.session",o.stringify(this.session.user.toJSON()));$(document).trigger("mouseout");
c={userId:c,language:this.language,threadId:this.thread.get("id"),forumId:this.forum.get("id"),forumPk:f.extract(this,"initialData.forum.pk").toString()};if(DISQUS.browser.mobile)window.open("about:blank",this.profileWindowName,"width=320,height=480"),c.windowName=this.profileWindowName;a.sendHostMessage("profile.show",c)},removePost:function(c){if(this.hasQueuedPosts())this.once("postsRendered",_.bind(this.removePost,this,c));else{var a=this.postViews[c.cid];a&&(a.remove(),delete this.postViews[c.cid])}},
removeOldPosts:function(){if(this.switches&&this.switches.enabled("next_realtime_cap")){var c=_.size(this.postViews)-this.STREAMING_MAX_VISIBLE;if(!(c<=0))for(var a=this.thread.posts.sortBy(function(c){return moment(c.get("createdAt")).valueOf()}),b,d=0,e=0;d<a.length&&e<=c;d++)if((b=this.postViews[a[d].cid])&&b.childrenNode.children().length===0)this.thread.posts.remove(a[d]),e+=1}},resize:function(){var c=f.getPageHeight();if(this._lastHeight!==c&&(!this._frozen||!(this._lastHeight&&this._lastHeight>
c)))this._lastHeight=c,a.sendHostMessage("resize",{height:c})},freeze:function(c){this._frozen=!!c;this._frozen===!1&&this.resize()},getPostView:function(c){return this.postViews[c]},windowOpen:function(c,a,b){window.open(c,"_blank","width="+a+",height="+b)},authenticate:function(c){var a=this.authServices[c];if(!a)return void DISQUS.log("Unknown authentication service: "+c);if(_.isFunction(a))return a.call(this);l.trigger("uiAction:openLogin",c);c={forum:this.thread.forum.get("id")};if(window.location.protocol===
"https:")c.redirect_secure=1;this.windowOpen(DISQUS.serialize(a.url,c),a.width,a.height)},handleAuth:d(function(c){this.authenticate(e(c.target,"auth"))}),authServices:{disqus:{url:DISQUS.urls.login,width:460,height:355},twitter:{url:DISQUS.urls.oauth.twitter,width:650,height:680},facebook:{url:DISQUS.urls.oauth.facebook,width:550,height:300},google:{url:DISQUS.urls.oauth.google,width:650,height:440},sso:function(){var c=parseInt(this.config.sso.width||"800",10),b=parseInt(this.config.sso.height||
"500",10),d=window.open(this.config.sso.url,"_blank","width="+c+",height="+b);(function F(){f.isWindowClosed(d)?a.sendHostMessage("reload"):_.delay(F,500)})()}},verifyEmail:d(function(){var c=DISQUS.serialize(DISQUS.urls.verifyEmail,{f:this.forum.id});window.open(c,"_blank","width=460,height=355")}),getAudienceSyncUrl:_.memoize(function(){var c={client_id:this.config.apiKey,response_type:"audiencesync",forum_id:this.forum.id};if(window.location.protocol==="https:")c.ssl=1;return DISQUS.serialize(DISQUS.urls.authorize,
c)}),audienceSync:d(function(){this.windowOpen(this.getAudienceSyncUrl(),460,355)})});m.getInstance=function(){return l};_.extend(m.prototype,t);_.extend(m.prototype,s);var j=Backbone.View.extend({updateDom:function(c,a){var b=m.getInstance();b&&b.initialized?b.updateDom(c,a):_.isFunction(c)&&c.call(a)},resize:function(){var c=m.getInstance();c&&c.initialized&&c.resize()}}),u=j.extend({events:{"click [data-action=share\\:twitter]":"_onShare","click [data-action=share\\:facebook]":"_onShare"},_onShare:d(function(c){if((c=
e(c.target,"share"))&&this.sharers[c])l.trigger("uiAction:threadShare",c),this.share(c)}),_shareUrl:function(){return this.model.url()}});_.extend(u.prototype,t);var w=j.extend({initialize:function(c){_.extend(this,c)},events:{"click [data-action=upvote]":"upvote"},render:function(){this.setElement($(DISQUS.renderBlock("threadVotes",{thread:this.thread.toJSON(),user:this.session.toJSON()})))},upvote:d(function(){this.vote(1)}),vote:function(c){this.trigger(c===1?"vote:up":"vote:down");var a=this.thread.get("userScore")===
c,b;this.thread.vote(a?0:c);a||(b=this.$el.find(".dropdown"),_.defer(function(){b.addClass("open")}))},remove:function(){this.off();Backbone.View.prototype.remove.call(this)}}),v=j.extend({events:{"click [data-action=subscribe]":"subscribe","keydown #thread-subscribe-email":"subscribeKeypress"},initialize:function(c){this.thread=c.thread;this.session=c.session;this.thread.on("change:userSubscription",this.updateStatus,this);this.updateStatus();this._boundDocumentClickHandler=_.bind(this._documentClickHandler,
this)},updateStatus:function(){this.thread.get("userSubscription")?this.$el.addClass("subscribed"):this.$el.removeClass("subscribed")},subscribe:d(function(){var c=this.thread.get("userSubscription");this.session.isAnonymous()&&!c?this.showForm():this.thread.subscribe(!c)}),showForm:function(){var c=this;this._unbindDocumentClickHandler();_.defer(function(){$(document.body).on("click",c._boundDocumentClickHandler)});c.$el.addClass("show-form").find("input")[0].focus()},_documentClickHandler:function(c){c.target.id!==
"thread-subscribe-email"&&this.hideForm()},_unbindDocumentClickHandler:function(){$(document.body).off("click",this._boundDocumentClickHandler)},hideForm:function(){this._unbindDocumentClickHandler();this.$el.removeClass("show-form").find("input")[0].blur()},subscribeKeypress:function(c){var a=this.$el.find("input");a.removeClass("alert error");if(c.key==="Esc"||c.keyCode===27)return void this.hideForm();if(!(c.key!=="Enter"&&c.keyCode!==13))c=c.target.value,f.validateEmail(c)?(this.hideForm(),this.thread.subscribe(!0,
c)):a.addClass("alert error")}}),E=j.extend({initialize:function(c){_.extend(this,c)},render:function(){var c=DISQUS.renderBlock("userMenu",{user:this.session.toJSON(),thread:this.thread.toJSON(),logoutUrl:this.logoutUrl,feedbackUrl:this.getSurveyMonkeyUrl()});this.updateDom(function(){this.$el.html(c)},this)},getSurveyMonkeyUrl:function(){var c=this.referrerUrl,a=this.session.user.id;return"https://www.surveymonkey.com/s/5RBPTTZ?c="+encodeURIComponent((a?[a,c]:[c]).join(";"))}}),z=new QueuedStorage(Modernizr.localstorage?
window.localStorage:DISQUS.next.utils.hashStorage,5,"drafts.queue"),C=function(c){if(!c)throw Error("Cannot instantinate MediaStore without a valid storageKey!");this._storageKey=c;this._store=Modernizr.localstorage?window.localStorage:DISQUS.next.utils.hashStorage};_.extend(C.prototype,{getItems:function(){var c=this._store.getItem(this._storageKey);return c&&o.parse(c)||{}},clear:function(){this._store.removeItem(this._storageKey)},getItem:function(c){return this.getItems()[c]},setItem:function(c,
a){var b=this.getItems();b[c]=a;this._store.setItem(this._storageKey,o.stringify(b));return a},removeItem:function(c){var a=this.getItems();if(c in a)return delete a[c],this._store.setItem(this._storageKey,o.stringify(a)),!0;return!1}});var q=j.extend({events:function(){var c={"click [data-action=attach]":"_attachMedia"};window.FormData&&_.extend(c,{dragover:"_dragOn",dragenter:"_dragOn",dragleave:"_dragOff",dragexit:"_dragOff",drop:"_drop"});return c},initialize:function(c){this.owner=c.owner;this.parent=
c.parent;this.url=c.url},setElement:function(){var c=j.prototype.setElement.apply(this,arguments);this.$dragPlaceholder=this.$el.find("[data-role=drag-drop-placeholder]");this.$mediaSelector&&this.$mediaSelector.off();this.$mediaSelector=this.$el.find("input[type=file][data-role=media-upload]");this.$mediaSelector.on("change",_.bind(this._selectorChange,this));return c},_toggleDragPlaceholder:_.throttle(function(c){c?this.$dragPlaceholder.show():this.$dragPlaceholder.hide()},50),_selectorChange:function(c){this.uploadMedia(c.target.files);
if(l.switches.enabled("next_dragdrop_nag")&&c.target.files&&Modernizr.localstorage&&!window.localStorage.getItem("usedDragDrop"))this.owner.alert(k("Did you know you can drag and drop images too? Try it now: drag images below.")).on("dismiss",function(){window.localStorage.setItem("usedDragDrop","1")})},_dragOn:function(c){c.stop();this._toggleDragPlaceholder(!0);this.owner.owner.$el.addClass("expanded")},_dragOff:function(c){c.stop();this._toggleDragPlaceholder(!1)},_drop:function(c){c.stop();window.localStorage.setItem("usedDragDrop",
"1");this._toggleDragPlaceholder(!1);this.uploadMedia(c.originalEvent.dataTransfer.files)},_attachMedia:function(c){c.stop();l.switches.enabled("next_use_jquery")?this.$mediaSelector.click():this.$mediaSelector[0].click()},_uploadMediaModern:function(c){for(var a=this,b=new FormData,d=0,e=c[d];e;e=c[++d])e.type.match(/^image\//)&&b.append("attachment",e);b.append("json","true");this.parent&&b.append("id",this.parent.id);var g=f.CORS.request("POST",this.url,function(){if(!(g.readyState!==void 0&&(g.readyState!==
4||g.status!==200))){var c=o.parse(g.responseText);c.success?a.owner.addMedia(c.media):a.owner.alert(c.message,"error")}},function(){var c=k("Unfortunately your image upload failed. Please verify that your image is under 2MB. If you continue seeing this error, please try again later.");g.status===413&&(c=k("Sorry, but the file you submitted is larger than 2 MB. Please make it smaller and try again."));a.owner.alert(c,"error")});g.withCredentials=!0;g.send(b)},_uploadMediaLegacy:function(){var c=this,
a=document.createElement("iframe"),b=document.createElement("form"),d=this.$mediaSelector[0];$(d).off();var e=$(d.cloneNode(!0));d.parentNode.replaceChild(e[0],d);e.on("change",_.bind(this._selectorChange,this));this.$mediaSelector=e;a.style.display="none";a.name="uploadFrame"+ +new Date;b.style.display="none";b.target=a.name;b.action=this.url;b.method="post";b.appendChild(a);b.appendChild(d);if(this.parent)a=document.createElement("input"),a.type="hidden",a.name="id",a.value=this.parent.id,b.appendChild(a);
b.enctype="multipart/form-data";b.encoding="multipart/form-data";var f=function(a){a=o.parse(a.data);a.name==="upload"&&($(b).remove(),$(window).off("message",f),a.data.success?c.owner.addMedia(a.data.media):c.owner.alert(a.data.message,"error"))};$(window).on("message",f);this.updateDom(function(){this.$el.append(b);b.submit()},this)},uploadMedia:function(c){this.uploadMedia=this["_uploadMedia"+(window.FormData?"Modern":"Legacy")];return this.uploadMedia(c)}}),p=j.extend({events:{"click [data-action=detach]":"_detachMedia"},
initialize:function(c){this.alert=_.bind(c.owner.alert,c.owner);this.owner=c.owner;this.parent=c.parent;this.urls=c.urls;this.uploader=new q({owner:this,parent:this.parent,url:this.urls.add})},setElement:function(){var c=j.prototype.setElement.apply(this,arguments);this.$list=this.$el.find("ul[data-role=media-preview-list]");return c},clear:function(){this.$el.addClass("empty");this.$list.empty();this.owner.mediaStore&&this.owner.mediaStore.clear()},_detachMedia:function(c){c.stop();this.updateDom(function(){this.removeMedia($(c.target).closest("li"))},
this)},addMedia:function(c){var a=$(DISQUS.renderBlock("mediaUpload",c));this.owner.mediaStore.setItem(c.location,c);a.attr("data-media-id",c.location);this.updateDom(function(){this.$list.append(a);this.$el.removeClass("empty")},this)},removeMedia:function(c){var a=this.owner.mediaStore.getItem(c.attr("data-media-id"));if(a){var b={media:o.stringify(a)};if(this.parent)b.id=this.parent.id;(new Image).src=DISQUS.serialize(this.urls.remove,b,!0);this.owner.mediaStore.removeItem(a.location);this.updateDom(function(){c.remove();
this.$list.children().length||this.$el.addClass("empty")},this)}}}),x=j.extend({events:{"click [name=author-register]":"expandRegister","click input[name=author-guest]":"managePassword","click [data-action=cancel]":"hide",submit:"submitForm"},initialize:function(c){this.session=c.session;this.parent=c.parent;this.thread=c.thread;this.parentView=c.parentView;this.session.on("change:id change:audienceSyncVerified",this.redraw,this);this._isHidden=!1;this.parent&&(x.open[this.parent.cid]=this);this.textarea=
Modernizr.contenteditable&&!DISQUS.browser.mobile&&(!window.opera||!window.opera.version)?new y({thread:this.thread}):new D;if(this.thread.forum.get("settings").allowMedia){if(c=this.storageKey("media"))this.mediaStore=new C(c);this.mediaUploads=new p({owner:this,parent:this.parent,urls:{add:this.thread.get("uploadAdd"),remove:this.thread.get("uploadRemove")}})}},storageKey:function(c){if(!this.thread.id)return null;return[c||"drafts","thread",this.thread.id,"parent",this.parent?this.parent.id:0].join(":")},
saveDraft:function(){this.storageKey()!==null&&z.setItem(this.storageKey(),o.stringify([this.textarea.get(),(new Date).getTime()]))},getDraft:function(){if(this.storageKey()===null)return null;var c=z.getItem(this.storageKey());if(!c)return null;c=o.parse(c);if(c[1]+86400>(new Date).getTime())return c[0];z.removeItem(this.storageKey());return null},restoreDraft:function(){var c=this.getDraft();c&&this.textarea.set(c)},updateAvatar:function(){this.$el.find("[data-role=user-avatar]").attr("src",this.session.user.get("avatar").cache)},
expandGuestForm:function(){this.updateDom(function(){this.$el.find("[data-role=guest-details]").addClass("expanded")},this)},expandRegister:function(){this.$el.toggleClass("register")},redraw:function(){var c=this.$el.hasClass("expanded"),a=this.el,b=this.$el.find("textarea").val();this.render();this.$el.find("textarea").val(b);c&&this.$el.addClass("expanded");$(a).parent().length!==0&&this.updateDom(function(){a.parentNode.replaceChild(this.el,a)},this)},render:function(){var c=this,a=c.getDraft()||
"";this.setElement($(DISQUS.renderBlock("form",{message:a,parent:c.parent?c.parent.toJSON():null,user:c.session.toJSON(),forumName:c.thread.forum.get("name"),audienceSyncRequired:c.session.needsAudienceSyncAuth(c.thread.forum),apiKey:l.config&&l.config.apiKey||"",mediaList:this.mediaStore?_.values(this.mediaStore.getItems()):[],allowAnonPost:c.thread.forum.get("settings").allowAnonPost,allowMedia:c.thread.forum.get("settings").allowMedia,showNewLogin:l.switches.enabled("next_new_login")})));var b=
this.textarea;b.setElement(c.$el.find("textarea")[0]);b.render();b.on("keychange",_.debounce(this.saveDraft,500),this);b.$el.on("focus",function(){c.$el.addClass("expanded focus");_.delay(_.bind(c.resize,c),200)});b.$el.on("blur",function(){b.get()||c.$el.removeClass("focus")});this.mediaUploads&&(this.mediaUploads.setElement(this.$el.find("[data-role=media-preview]")[0]),this.mediaUploads.uploader.setElement(this.$el.find("[data-role=textarea]")[0]));c.$el.find("input[name=author-name]").on("focus",
function(){c.expandGuestForm()});c.session.get("mustVerifyEmail")&&c._alertMustVerify();c._isHidden&&c.$el.addClass("hidden")},resize:function(){this.textarea.resize()},focus:function(){this.textarea.focus()},clear:function(){var c=this;c.textarea.clear();c.$el.removeClass("expanded");c.mediaUploads&&c.mediaUploads.clear();_.delay(function(){c.resize()},200);c.parent?c.hide():c.setInactive();this.storageKey()&&z.removeItem(this.storageKey())},setInactive:function(){this.$el.removeClass("expanded")},
restore:function(c){var a=this;a.textarea.set(c.get("raw_message"));_.delay(function(){a.resize()},200);a.parent&&a.show()},managePassword:function(){var c=this.$el,a=c.find("input[name=author-guest]");if(c=c.find("input[name=author-password]"))window.$&&window.$.fn&&window.$.fn.jquery&&window.$.fn.jquery.indexOf("1.9.2")>-1?(c[a.is(":checked")?"hide":"show"](),c.val("")):(c[a.attr("checked")?"hide":"show"](),c.attr("value",""))},_alertMustVerify:function(c){this.alert(DISQUS.interpolate(k("%(forumName)s requires you to %(verifyEmail)s before posting"),
{forumName:this.thread.forum.get("name"),verifyEmail:'<a href="#" data-action="verify-email">'+k("verify your email address")+"</a>"}),{safe:!0,type:c?"error":"warn"})},getPassword:function(){var c=this.$el.find("input[name=author-password]");if(c.length)return c.val();return null},submitForm:function(c){c&&c.preventDefault&&c.preventDefault();if(this._alert)this._alert.remove(),this._alert=null;c=this.$el.find("input[name=author-register]");c=c.length&&c[0].checked;l.switches.enabled("next_new_login")&&
(c=this.$el.find("input[name=author-guest]"),c=c.length&&!c[0].checked);if(this.session.isAnonymous()&&c)return void this.registerUser();return this.createPost()},registerUser:function(){function c(c){c=c.response;/The e-mail address you specified is already in use./i.test(c)?a.alert(k("The e-mail address you specified is already in use. (Do you already have an account?)"),"error"):/Unable to create user/i.test(c)?a.alert(k("That email address is already registered with a Disqus account. Log in or enter another email."),
"alert"):a.alert(c,"error")}var a=this,b=new h.User({display_name:a.$el.find("input[name=author-name]").val(),email:a.$el.find("input[name=author-email]").val(),password:a.getPassword()});if(!b.isValid())return c({response:b.validationError});b.register({error:c,success:function(){a.session._setUser(b);a.alert(k("Your account was created successfully."),{success:!0});l.trigger("uiAction:finishRegistrationEmbed")}})},createPost:function(){var c=this,a={thread:c.thread.id,depth:c.parent?c.parent.get("depth")+
1:0,parent:c.parent?c.parent.id:null,raw_message:c.textarea.get()};c.session.isRegistered()?a.author_id=c.session.user.id:_.extend(a,{author_name:c.$el.find("input[name=author-name]").val(),author_email:c.$el.find("input[name=author-email]").val()});var b=new DISQUS.next.models.UniqueModel(DISQUS.next.models.Post);if(!b.set(a,{validate:!0}))return void c.alert(b.validationError,"error");var d=null,e=function(a,i){if(i.code===19){if(d)return d.reload();d=new N;d.render();var e=l.getPostView(b.cid);
e.el.parentNode.insertBefore(d.el,e.el);d.start();d.on("submitted",function(){b.save({recaptcha_challenge_field:d.getChallenge(),recaptcha_response_field:d.getResponse()},{success:function(){d.remove()}})})}else i.code===12&&/verify/.test(i.response)?c._alertMustVerify(!0):_.isString(i.response)&&c.alert(i.response,"error"),c.thread.posts.remove(b),c.restore(b),c.thread.incrementPostCount(-1)};b.on("error",e);b.on("sync",function ca(){c.thread.trigger("create",b);b.off("error",e);b.off("sync",ca)});
b.save(a);b.author=c.session.isRegistered()?c.session.user:new h.UniqueModel(h.User,{id:md5(a.author_email),name:a.author_name,email:a.author_email});c.thread.incrementPostCount(1);b.created=!0;c.thread.posts.add(b);c.clear();l.trigger("uiAction:createPost",b);return b},prependTo:function(c){c=c[0];c.insertBefore(this.el,c.firstChild)},remove:function(){this.updateDom(function(){this.$el.remove()},this);this.parent&&(delete x.open[this.parent.cid],this.typingStop())},toggle:function(){this.isOpen()?
this.hide():this.show()},show:function(){var c=this;c._isHidden=!1;c.updateDom(function(){c.$el.removeClass("hidden")});c.typingStart()},hide:function(){var c=this;c._isHidden=!0;c.dismissAlert();c.updateDom(function(){c.$el.addClass("hidden")});c.typingStop()},isOpen:function(){return!this._isHidden},typingStart:function(){var c=this;c.parent&&m.getInstance().isRealtimeEnabled()&&_.delay(function(){var a=DISQUS.urls.realertime+"/api/2/typing/",b;f.attempt(function(){b=f.CORS.request("POST",a)});
if(b===null)return void DISQUS.log("CORS is not supported by this browser.");var d=o.stringify({typing:!0,forum_url:c.thread.get("forum"),thread_id:c.thread.get("id"),user_id:c.session.user.id||0,parent_post_id:c.parent.get("id")});f.attempt(function(){b.send(d)})},500)},typingStop:function(){var c=this;c.parent&&m.getInstance().isRealtimeEnabled()&&_.delay(function(){var a=DISQUS.urls.realertime+"/api/2/typing/",b;f.attempt(function(){b=f.CORS.request("POST",a)});if(b===null)return void DISQUS.log("CORS is not supported by this browser.");
var d=o.stringify({typing:!1,forum_url:c.thread.get("forum"),thread_id:c.thread.get("id"),user_id:c.session.user.id||0,parent_post_id:c.parent.get("id")});f.attempt(function(){b.send(d)})},500)}});_.extend(x.prototype,s);x.open=x.open||{};var L=x.extend({events:function(){return _.extend({},x.prototype.events,{"click [data-action=toggle-login-buttons]":"toggleLoginButtons"})},initialize:function(){x.prototype.initialize.apply(this,arguments);this._windowScrollTop=null;this._isHidden=!0},show:function(){if(this._windowScrolltop!==
null)this._windowScrollTop=$(window).scrollTop();$("#layout").hide();_.defer(_.bind(function(){x.prototype.show.call(this)},this))},hide:function(){x.prototype.hide.call(this);$("#layout").show();if(this._windowScrollTop!==null)window.scrollTo(0,this._windowScrollTop),this._windowScrollTop=null},setInactive:function(){this.hide()},prependTo:function(){x.prototype.prependTo.call(this,$("#fixed-content"))},toggleLoginButtons:function(){this.$el.find("[data-role=login-buttons]").toggleClass("active")}}),
M=j.extend({initialize:function(c){this.post=c.post;this.textarea=new D},render:function(){this.setElement($(DISQUS.renderBlock("edit",{post:this.post.toJSON()})));this.$el.find("form").on("submit",_.bind(this.submitForm,this));var c=this.textarea;c.setElement(this.$el.find("textarea")[0]);c.render()},resize:function(){this.textarea.resize()},submitForm:function(c){c&&c.preventDefault()&&c.preventDefault();var c={raw_message:this.textarea.get()},a=this.post.validate(c);if(a!==void 0)return alert(a);
this.trigger("submitted");this.post.save(c,{success:function(){}})},remove:function(){this.updateDom(function(){this.$el.remove()},this)}}),A=j.extend({initialize:function(c){this.MAX_POST_HEIGHT=374;this.thread=c.thread;this.session=c.session;this.created=!!c.created;this.model.on("destroy",this.removeAsDeleted,this);this.model.on("spam",this.removeAsDeleted,this);this.model.on("change:message",this.stopLoading,this);this.model.on("change:points",this.updateVotePoints,this);this.model.on("change:userScore",
this.updateActiveUserVote,this);this.model.usersTyping.on("add remove reset",this.updateTypingCount,this);this.session.on("change:id",this.updateEditHide,this);this.session.on("change:id",this.updateFooter,this);this.session.on("change:id",this.updateMenu,this);this.model.on("change",function(){var c=this.model.changedAttributes();(c.id||c.message)&&this.redraw()},this);this.edit=this.reply=null;this.parent=c.parent;this.trackPosition=!1;this.offset={top:-1,height:-1};this.dim={height:-1,width:-1};
m.getInstance().on("domReflow",function(){if(!this.trackPosition||!this.visible)this.offset={top:-1,height:-1},this.dim={height:-1,width:-1};else{var c=this.contentNode;this.offset=c.offset();this.dim=c.dim()}},this);this.isCollapseAllowed=!0},updateTypingCount:function(){this.typingUserView&&this.typingUserView.render()},stopLoading:function(){this.contentNode.find(".loading").removeClass("loading")},updateRelativeTime:function(){this.contentNode.find("[data-role=relative-time]").text(this.model.getRelativeCreatedAt())},
updateActiveUserVote:function(){var c=this.model,a=this.contentNode.find("[data-action=upvote]"),b=this.contentNode.find("[data-action=downvote]");b.removeClass("downvoted");a.removeClass("upvoted");c.get("userScore")>0?a.addClass("upvoted"):c.get("userScore")<0&&b.addClass("downvoted");l.trigger("activeUserVoteUpdate",this.model.get("id"))},updateVotePoints:function(c){var a=this.contentNode.find("[data-role=likes], [data-role=dislikes]"),b=this.contentNode.find("[data-action=upvote], [data-action=downvote]"),
d=function(c){_.delay(function(){c.addClass("update");_.delay(function(){c.removeClass("update")},1E3)},500)};_.each(a,function(a,i){var a=$(a),e=a.html(),f=c.get(a.attr("data-role")).toString(),g=$(b[i]);e!==f&&(g.addClass("count-"+f),g.removeClass("count-"+e),a.html(f),d(a))})},updateEditHide:function(){var c=this.contentNode.find("[data-role=edit-hide]"),a=DISQUS.renderBlock("postEditHide",{post:{author:{id:this.model.author.id}},session:{id:this.session.user.id}});this.updateDom(function(){c.html(a)})},
updateFooter:function(){var c=this.contentNode.find("footer"),a=DISQUS.renderBlock("postFooter",{post:this.model.toJSON(),session:this.session.toJSON(),thread:this.thread.toJSON()});this.updateDom(function(){c.html(a)});this.updateUpvotersCardTarget()},updateMenu:function(){var c=this.contentNode.find("[data-role=menu]"),a=DISQUS.renderBlock("postMenu",{session:this.session.toJSON(),post:this.model.toJSON()});this.updateDom(function(){c.html(a)})},getMessageContainer:function(){if(!this.messageContainer||
!this.messageContainer.length)this.messageContainer=this.contentNode.find("[data-role=message-container]");return this.messageContainer},getMessageContent:function(){if(!this.messageContent||!this.messageContent.length)this.messageContent=this.contentNode.find("[data-role=message-content]");return this.messageContent},getMoreButton:function(){if(!this.seeMoreButton||!this.seeMoreButton.length)this.seeMoreButton=this.contentNode.find("[data-action=post-expand]");return this.seeMoreButton},getShadowEl:function(){if(!this.shadowNode||
!this.shadowNode.length)this.shadowNode=this.contentNode.find("[data-role=message-shadow]");return this.shadowNode},manageMessageHeight:function(){var c=this.getMessageContent(),a=this.MAX_POST_HEIGHT;this.isCollapseAllowed&&(c&&c.length&&c.height()>a*1.5&&!this.$el.hasClass("collapsed")?this.collapseMessage():this.expandMessage(!0))},collapseMessage:function(){var c=this.getMessageContainer(),a=this.MAX_POST_HEIGHT;c&&c.length&&!c.hasClass("post-message-collapse")&&(this.updateDom(function(){c.addClass("post-message-collapse");
c.height(a)}),this.addMoreButton())},expandMessage:function(c){if(this.messageContainer&&this.messageContainer.length){var a=this.getMessageContainer();this.updateDom(function(){a.removeClass("post-message-collapse");a.css("height","auto")});this.removeMoreButton();if(c!==!0)this.isCollapseAllowed=!1}},addMoreButton:function(){var c=this.getMoreButton(),a=this.getShadowEl();this.updateDom(function(){a.removeClass("hidden");c.removeClass("hidden")})},removeMoreButton:function(){var c=this.getMoreButton(),
a=this.getShadowEl();this.updateDom(function(){c.addClass("hidden");a.addClass("hidden")})},markSeen:function(){function c(d){var e,f;if(!d)return!1;if(a.dim.height<=0||a.dim.width<=0)return!1;e=a.offset.top+d.frameOffset.top;f=(f=e>d.pageOffset)&&e+a.dim.height<=d.pageOffset+d.height;if(!f)return!1;a.contentNode.addClass("seen");_.delay(function(){a.contentNode.removeClass("seen");a.contentNode.removeClass("new")},1E4);a.trackPosition=!1;b.off("scroll",c);return!0}var a=this,b=m.getInstance();if(!c(b.position))b.on("scroll",
c,a)},render:function(){var c=this,a=c.parent&&c.parent.model;c.setElement($(DISQUS.renderBlock("post",{post:c.model.toJSON(),session:c.session.toJSON(),thread:c.thread.toJSON(),loading:!c.model.id,created:c.created,parentAuthorName:a?a.author.get("name"):null,thumbnailWidth:l.loadedThumbnailWidth,thumbnailHeight:l.MAX_MEDIA_HEIGHT})));c.contentNode=c.$el.find("[data-role=post-content]");c.childrenNode=c.$el.find("[data-role=children]");c.messageNode=c.contentNode.find("[data-role=message]");this.highlightSyntax();
if(c.model.get("isRealtime"))m.getInstance().switches.enabled("next_realtime_anim_disabled")?c.contentNode.removeClass("new"):(c.trackPosition=!0,l.once("postsRendered",c.markSeen,c));l.on("postsRendered",_.once(function(){_.defer(function(){var a=c.$el.find("[data-role=realtime-notification\\:"+c.model.id+"] .realtime-replies");c.manageMessageHeight();c.typingUserView=new U({parentView:c,model:c.model,el:a})})}));c.processMentions();c.bindDomEvents();if(a&&!a.get("isDeleted"))c.contextCard=J.create({post:this.parent.model,
targetElement:this.$el.find("[data-role=parent-link]")})},highlightSyntax:function(){var c=this.contentNode.find("pre code");c.length&&c.each(function(c){f.syntaxHighlighter.highlight(c)})},redraw:function(){var c=this.$el;if(!c)throw Error("Old child not found on PostView.redraw");var a=this.childrenNode.children();this.render();this.updateDom(function(){c[0].parentNode.replaceChild(this.el,c[0]);this.childrenNode.append(a)},this)},processMentions:function(){this.contentNode.find("[data-dsq-mention]").each(function(){$(this).addClass("mention")})},
attachChild:function(c){var a=c.model;a.created||!a.id||a.get("isImmediateReply")?this.childrenNode.prepend(c.el):this.childrenNode.append(c.el)},drawReply:function(){this.reply&&(this.reply.render(),this.updateDom(function(){this.reply.prependTo(this.childrenNode);this.reply.show();this.reply.focus()},this))},toggleEdit:function(){this.edit?(this.edit.remove(),this.edit=null,this.messageNode.show()):(this.edit=new M({post:this.model}),this.edit.render(),this.edit.on("submitted",this.toggleEdit,this),
this.expandMessage(!0),this.updateDom(function(){var c=this.messageNode;c[0].parentNode.insertBefore(this.edit.el,c[0]);c.hide();this.edit.resize();(c=m.getInstance())&&c.scrollToPost(this.model.id)},this))},removeAsDeleted:function(){this.redraw()},bindDomEvents:function(){var c=this;c.delegateActions(c.contentNode,{upvote:function(){c.handleVote(1)},downvote:function(){c.handleVote(-1)},reply:"handleReply",flag:"handleFlag",edit:"handleEdit","delete":"handleDelete",spam:"handleSpam",blacklist:"handleBlacklist",
collapse:"handleCollapse",reveal:"handleReveal","share:twitter":"_onShare","share:facebook":"_onShare","post-expand":d(c.expandMessage)});var a=c.$el.find(".hovercard");if(a.length)c.profileCard=H.create({session:c.session,user:c.model.author,targetElement:a});if(!c.upvotersCard&&c.model.get("id"))c.upvotersCard=K.create({session:c.session,model:c.model,postId:c.model.get("id")});c.updateUpvotersCardTarget()},updateUpvotersCardTarget:function(){var a=this.$el.find('[data-action="upvote"]');a.length&&
this.upvotersCard&&this.upvotersCard.target(a)},_onShare:function(a){if(a=e(a.target,"share"))l.trigger("uiAction:postShare",a),this.share(a)},_shareUrl:function(){return this.thread.url()+"#comment-"+this.model.id},handleBlacklist:function(){if(!this.blacklist){var a=this.blacklist=new V({model:this.model});a.render();a.on("success cancel",function(){this.blacklist.remove();this.blacklist=null},this);this.updateDom(function(){this.contentNode.find("[data-role=blacklist-form]").first().append(a.el)},
this)}},handleCollapse:function(){this.updateDom(function(){this.$el.toggleClass("collapsed");this.manageMessageHeight()},this)},handleVote:function(a){a===1?l.trigger("uiAction:postUpvote"):a===-1&&l.trigger("uiAction:postDownvote");this.model.vote(this.model.get("userScore")===a?0:a)},remove:function(){this.model.off(null,null,this);this.session.off(null,null,this);Backbone.View.prototype.remove.call(this)},getReplyView:function(){if(this.reply)return this.reply;var a=x,b=m.getInstance();b&&b.getPostReplyViewClass&&
(a=b.getPostReplyViewClass());this.reply=new a({parentView:this,parent:this.model,thread:this.thread,session:this.options.session});this.drawReply();return this.reply},handleReply:function(){this.reply?this.getReplyView().toggle():this.getReplyView()},handleFlag:function(){var a=k("Are you sure you want to flag this comment?");window.confirm(a)&&this.model.report()},handleEdit:function(){this.toggleEdit()},handleDelete:function(){this.model.destroy()},handleSpam:function(){this.model.spam()},handleReveal:function(){this.model.set("isMinimized",
!1);this.redraw()}});_.extend(A.prototype,t);var B=A.extend({initialize:function(){A.prototype.initialize.apply(this,arguments);this._boundScrollHandler=null},bindDomEvents:function(){A.prototype.bindDomEvents.call(this);this.contentNode.on("click",_.bind(this.toggleActive,this))},toggleActive:function(){var a=this.contentNode;if(B.active)B.active.contentNode.removeClass("active"),$(window).off("scroll",this._boundScrollHandler),this._boundScrollHandler=null;B.active!==this?(B.active=this,a.addClass("active"),
this._boundScrollHandler=_.bind(_.throttle(this.checkFooterClip,100),this),$(window).on("scroll",this._boundScrollHandler),this.checkFooterClip()):B.active=null},checkFooterClip:function(){var a=this.getMessageContent(),b=this.contentNode.find("footer"),d=a.offset().top,a=d+a.height()+b.height(),e=document.documentElement.clientHeight,e=$(window).scrollTop()+e;a>e&&d<e?b.addClass("fixed"):b.removeClass("fixed")}}),N=j.extend({render:function(){var a=this;a.setElement($(DISQUS.renderBlock("captcha")));
a.$el.on("submit",function(b){b.preventDefault();a.trigger("submitted")})},start:function(){function a(){b.updateDom(function(){Recaptcha.create("6LdKMrwSAAAAAPPLVhQE9LPRW4LUSZb810_iaa8u",b.el,{theme:"custom",custom_theme_widget:"recaptcha_widget"});b.$el.show()})}var b=this;typeof Recaptcha==="undefined"?DISQUS.require("//www.google.com/recaptcha/api/js/recaptcha_ajax.js",{},!1,a):a()},getChallenge:function(){return Recaptcha.get_challenge()},getResponse:function(){return Recaptcha.get_response()},
reload:function(){Recaptcha.reload()}}),I=j.extend({initialize:function(a){this.session=a.session;this.showZero=a.showZero||!1;this.max=a.max;this.session.on("change:notificationCount",this.render,this)},render:function(){var a=this.session.get("notificationCount")||0;this.max&&(a=Math.min(a,this.max));this.$el.html("<span>"+a+"</span>");a>0||this.showZero?this.$el.show():this.$el.hide();return this}}),G=Backbone.View.extend({__type__:"QueuedPostView",getDirection:function(a){if(this.offset&&this.dim){var b=
a.pageOffset,d=this.offset.top+a.frameOffset.top;if(d+this.dim.height<b)return 1;if(d>b+a.height)return-1;return 0}},setCount:function(a){this.options.count=a},bindDrain:function(){var a=_.bind(this.drainHandler,this);if(!this.clickEvent){if(this.$el.attr("data-action")=="load-queued-posts")this.$el.on("click",a);else this.$el.delegate("[data-action=load-queued-posts]","click",a);this.clickEvent=!0}},render:function(){var a=this;if(a.options.count===0)return void a.$el.hide();a.$el.html(DISQUS.renderBlock("realtimeCommentNotification",
{comments:a.options.count}));a.bindDrain();m.getInstance().on("domReflow",_.throttle(function(){if(a.options.count!==0)this.offset=a.$el.offset(),this.dim=a.$el.dim()},400),this);a.$el.show()},drainHandler:function(){this.model.queue.drain();this.setCount(this.model.queue.counters.comments);this.render()}}),Q=G.extend({getDirection:function(a){if(this.options.postView.visible)return this.offset=this.options.postView.offset,this.dim=this.options.postView.dim,a=G.prototype.getDirection.call(this,a),
delete this.offset,delete this.dim,a},render:function(){var a=this,b=a.options.postView;DISQUS.log("Model:",a.model.id);a.options.count===0?(a.$el.hide(),b.trackPosition=!1):(b.trackPosition=!0,a.$el.html(DISQUS.renderBlock("realtimeReplyNotification",{replies:a.options.count})),a.bindDrain(),a.$el.show(),_.delay(function(){a.$el.addClass("reveal")},13))},drainHandler:function(){var a=this.model.id,b=this.options.postView,d=this.options.thread.queue;d.drain(a);this.setCount(d.counters.replies[a]);
b.trackPosition=!1;this.render()}}),U=Backbone.View.extend({render:function(){var a=this.model.usersTyping.count(),b=this.options.parentView.reply;b&&b.isOpen()&&(a-=1);if(a<=0)return void this.$el.hide();a==1?this.$el.html("One other user is typing&hellip;"):this.$el.html(a+" other users are typing&hellip;");this.$el.show()}}),t=j.extend({tagName:"ul",className:"loading",initialize:function(a){this.collection.on("reset",this.render,this);this.session=a.session},render:function(){this.updateDom(function(){this.$el.removeClass("loading");
this.$el.empty();this.collection.each(function(a){this.$el.append(DISQUS.renderBlock("activityItem",{activity:a.toJSON(),session:this.session?this.session.toJSON():null}))},this);this.trigger("render")},this);return this}}),S=j.extend({events:{"click [data-action=network]":"showNetwork","click [data-action=notifications]":"showNotifications"},initialize:function(a){this.network=new W;this.notifications=new X({notifications:a.session.notifications});this.notificationCount=new I({session:a.session,
showZero:!0});this._views={network:this.network,notifications:this.notifications};this.network.on("render:activity",_.bind(this.trigger,this,"render:all"))},render:function(){this.updateDom(function(){this.$el.html(DISQUS.renderBlock("dashboard"))},this);this._tabs={network:this.$el.find("[data-role=network-tab]"),notifications:this.$el.find("[data-role=notifications-tab]")};this.network.setElement(this.$el.find("[data-role=network]"));this.notifications.setElement(this.$el.find("[data-role=notifications]"));
this.notificationCount.setElement(this.$el.find("[data-role=notification-count]"));this.network.render();this.notifications.render();this.notificationCount.render()},show:function(){this.setActiveTab("notifications")},setActiveTab:function(a){var b=m.getInstance();b.freeze(!0);_.chain(this._tabs).invoke("removeClass","active");this._tabs[a].addClass("active");_.chain(this._views).pluck("$el").invoke("hide");var d=this._views[a];this.updateDom(function(){d.$el.show();b.freeze(!1)},this);d.show&&d.show()},
showNetwork:d(function(){this.setActiveTab("network");m.getInstance().trigger("uiAction:navigate","network")}),showNotifications:d(function(){this.setActiveTab("notifications");m.getInstance().trigger("uiAction:navigate","dashboard")})}),Y=j.extend({events:{"click [data-action=more]":d(function(){this.trigger("fire")})},setBusy:function(){this.$el.find("[data-action=more]").addClass("busy").removeAttr("disabled")},setReady:function(){this.$el.find("[data-action=more]").removeClass("busy").removeAttr("disabled");
this.updateDom(function(){var a=this.collection.cursor;a&&a.hasNext?this.$el.show():this.$el.hide()},this)}}),X=j.extend({initialize:function(a){this.notifications=a.notifications;this.notifications.on("reset",this.resetNotifications,this);this.notifications.on("add:many",this.addNotifications,this);this.notifications.on("reset add:many",this.markNotificationsAsRead,this);this._fetched=!1;this.moreButton=new Y({collection:this.notifications});this.moreButton.on("fire",this.loadMore,this)},render:function(){return this.renderLayout()},
renderLayout:function(){this.updateDom(function(){this.$el.html(DISQUS.renderBlock("notifications"));this.moreButton.setElement(this.$el.find("[data-role=more-notifications]"));this.$el.addClass("loading")},this);return this},resetNotifications:function(a){var b=this.$el.find("[data-role=no-notifications]");b.hide();this.$el.removeClass("loading");a.size()===0?b.show():(b.hide(),this.addNotifications.apply(this,arguments))},addNotifications:_.decorate(Backbone.collectionAddNormalizer(g.NotificationCollection,
h.Notification),function(a){var b=_.map(a,function(a){return $(DISQUS.renderBlock("notification",{notification:a.toJSON()}))[0]});this.updateDom(function(){this.$el.find("[data-role=entries]").append(b)},this);this.moreButton.setReady();this.notifications.markRead();return this}),show:function(){if(!this._fetched)this.notifications.fetch({reset:!0}),this._fetched=!0},loadMore:function(){this.moreButton.setBusy();this.notifications.more()}}),W=j.extend({initialize:function(){this.posts=new g.PostActivityCollection;
this.posts.on("reset",this.resetActivity,this);this.posts.on("add:many",this.addActivity,this);this._fetched=!1;this.moreButton=new Y({collection:this.posts});this.moreButton.on("fire",this.loadMore,this)},render:function(){return this.renderLayout()},renderLayout:function(){this.updateDom(function(){this.$el.html(DISQUS.renderBlock("networkActivity"));this.moreButton.setElement(this.$el.find("[data-role=more-activity]"));this.$el.addClass("loading")},this);return this},resetActivity:function(a){var b=
this.$el.find("[data-role=no-activity]");b.hide();this.$el.removeClass("loading");a.size()===0?b.show():(b.hide(),this.addActivity.apply(this,arguments))},addActivity:_.decorate(Backbone.collectionAddNormalizer(g.PostActivityCollection,h.Post),function(a){var b=new Backbone.Collection;_.each(a,function(a){var c=b.get(a.get("thread").id)||new h.Thread(_.extend(a.get("thread"),{forum:a.get("forum")}));c.posts.add(a);b.add(c)});var d=b.map(function(a){var c=$(DISQUS.renderBlock("networkActivityThreadEntry",
{thread:a.toJSON()})),a=a.posts.map(function(a){return $(DISQUS.renderBlock("networkActivityPostEntry",{post:a.toJSON()}))[0]});c.find("[data-role=posts]").append(a);return c[0]});this.updateDom(function(){this.$el.find("[data-role=entries]").append(d);this.trigger("render:activity")},this);this.moreButton.setReady();return this}),show:function(){if(!this._fetched)this.posts.fetch({reset:!0}),this._fetched=!0},loadMore:function(){this.moreButton.setBusy();this.posts.more()}}),Z=j.extend({tagName:"ol",
className:"loading",initialize:function(){this.collection.on("reset",function(){this.updateDom(this.render,this)},this)},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(a){var b=DISQUS.time.assureTzOffset(a.get("createdAt"));this.$el.append(DISQUS.renderBlock("topThread",{id:a.id,title:a.get("title"),url:a.get("link"),numPosts:a.get("posts"),numLikes:a.get("likes"),timeAgo:moment(b,DISQUS.time.ISO_8601).fromNow()}))},this);
this.trigger("render")},this);this.attachPosts();return this},attachPosts:function(){this.collection.each(function(a){this.renderPost(a)},this)},renderPost:function(a){var b=a.get("topPost");if(b){var d=_.escape(_.strip(b.message)),d=_.truncate(d,160,"&hellip;"),e=DISQUS.renderBlock("topThreadPost",{message:d,author:b.author});this.updateDom(function(){this.$el.find("[data-role=thread-"+a.id+"] [data-role=top-thread-post]").html(e)},this)}}}),aa=j.extend({tagName:"ol",className:"loading",initialize:function(){this.collection.on("reset",
function(){l.thread.users.add(this.collection.models,{merge:!0});this.updateDom(this.render,this)},this)},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(a){this.$el.append(DISQUS.renderBlock("topUser",{user:a.toJSON()}))},this);this.trigger("render")},this);return this}}),T=Backbone.View.extend({initialize:function(a){var b=this;b.forum=a.forum;b.topThreads=new Z({id:"top-threads",collection:new g.TopThreadCollection(null,
{forum:b.forum.id,limit:10})});b.topUsers=new aa({id:"top-users",collection:new g.TopUserCollection(null,{forum:b.forum.id,limit:20,discardLowRep:l.switches.enabled("next_discard_low_rep")})});Backbone.when([b.topUsers,"render"],[b.topThreads,"render"]).then(function(){b.isRendered=!0;b.trigger("render:all")});b.fetched=!1;b.render()},render:function(){this.$el.html(DISQUS.renderBlock("community",{forum:this.forum.toJSON()}));this.$el.find("[data-role=top-threads]").append(this.topThreads.el);this.$el.find("[data-role=top-users]").append(this.topUsers.el);
return this},show:function(){if(!this.fetched)this.topThreads.collection.fetch({reset:!0}),this.topUsers.collection.fetch({reset:!0}),this.fetched=!0}}),ga={toggleFollow:d(function(){this.user.get("isFollowing")?this.user.unfollow():(this.user.follow(),l.trigger("uiAction:followUser"))})},r=j.extend({initialize:function(){this._id=_.uniqueId();this._rendered=!1;this._hoverState="out";this._visible=!1;this._leaveTimeout=this._enterTimeout=null;r.open={};this.events=this.events||{};this.events["click [data-action=profile]"]=
"handleShowProfile"},bindEvents:function(){this.$el.on("mouseenter",_.bind(this.enter,this,null));this.$el.on("mouseleave",_.bind(this.leave,this))},render:function(){this.$el.hide();$("body").append(this.el);this.bindEvents()},target:function(a){a.on("mouseenter",_.bind(this.enter,this,a));a.on("mouseleave",_.bind(this.leave,this))},enter:function(a){var b=this;if(a)b.$target=a;b._leaveTimeout&&clearTimeout(b._leaveTimeout);if(b._hoverState!=="in")b._hoverState="in",b._enterTimeout=_.delay(function(){b._hoverState===
"in"&&b.show();b._enterTimeout=null},r.DELAY_ENTER),r.open[this.uid]=this},leave:function(){var a=this;a._enterTimeout&&clearTimeout(a._enterTimeout);if(a._hoverState!=="out")a._hoverState="out",a._leaveTimeout=_.delay(function(){a._hoverState==="out"&&a.hide();a._leaveTimeout=null},r.DELAY_LEAVE),r.open[this.uid]&&delete r.open[this.uid]},show:function(){if(!this._rendered)this._rendered=!0,this.render();this.moveTo(this.$target);this.$el.show();this._visible=!0},moveTo:function(a){if(a){var b=r.POSITION_OFFSET,
a=a.offset(),d=this.$el,e=d.dim(),f=m.getInstance().position;a.top-=b;a.top+e.height+f.frameOffset.top-f.pageOffset<=f.height?d.css("top",a.top):d.css("top",a.top-e.height+b*2);d.css("left",a.left+b)}},hide:function(){this.$el.hide();this._visible=!1},isVisible:function(){return this._visible},handleShowProfile:d(function(a){a=$(a.currentTarget).attr("data-user");l.showProfile(a);this.hide()})},{open:{},instances:{},DELAY_ENTER:350,DELAY_LEAVE:175,POSITION_OFFSET:20,exitAll:function(){_.invoke(r.open,
"leave")},create:function(a,b,d,e){var f=r.instances[d];f||(r.instances[d]=f={});d=f[a];d||(d=new e(b),f[a]=d);b.targetElement&&d.target(b.targetElement);return d}});(function(){$(document).on("mouseout",_.debounce(function(a){a=a.relatedTarget||a.toElement;(!a||a.nodeName==="HTML")&&r.exitAll()},10))})();var H=r.extend({events:{"click [data-action=toggleFollow]":"toggleFollow"},initialize:function(a){var b=this;r.prototype.initialize.call(b,a);b.session=a.session;b.user=a.user;b._fetched=!1;b.user.on("change:numPosts change:numLikesReceived",
_.debounce(function(){b.updateCounters()}));b.user.on("change:isFollowing",b.updateActions,b);b.session.on("change:id",function(){b._rendered&&b.render()})},serialize:function(){return{user:this.user.toJSON({session:this.session}),sessionId:this.session.user.id}},render:function(){this.setElement($(DISQUS.renderBlock("hovercard",this.serialize())));r.prototype.render.call(this)},updateCounters:function(){this.$el.find("[data-role=counters]").html(DISQUS.renderBlock("hovercardCounters",this.serialize()))},
updateActions:function(){this.$el.find("[data-role=actions]").html(DISQUS.renderBlock("hovercardActions",this.serialize()))},show:function(){if(!this._fetched)this._fetched=!0,this.user.fetch();r.prototype.show.call(this)}},{create:function(a){return r.create(a.user.id,a,"ProfileCard",H)}});_.extend(H.prototype,ga);var J=r.extend({initialize:function(a){r.prototype.initialize.call(this,a);this.post=a.post},render:function(){var a=this.post.toJSON();a.excerpt=_.truncate(_.escape(_.strip(a.message),
40,"..."));this.setElement($(DISQUS.renderBlock("contextCard",{post:a})));r.prototype.render.call(this)}},{create:function(a){return r.create(a.post.id,a,"ContextCard",J)}}),O=j.extend({events:{"click [data-action=dismiss]":"dismiss"},initialize:function(a){_.extend(this,a)},render:function(){this.setElement($(DISQUS.renderBlock("alert",{message:this.message,type:this.type,safe:this.safe})));return this},dismiss:function(a){a&&a.preventDefault&&a.preventDefault();this.remove();this.trigger("dismiss")}}),
V=j.extend({events:{"click [data-action=cancel]":"cancel"},initialize:function(){var a=this;a.loading=!1;if(!a.model.get("ipAddress"))a.loading=!0,a.model.once("change:ipAddress",function(){a.loading=!1;a.redraw()}),a.model.fetch()},render:function(){var a=this;a.setElement($(DISQUS.renderBlock("blacklist",{loading:this.loading,post:a.model.toJSON()})));a.$el.on("submit",function(b){b&&b.preventDefault()&&b.preventDefault();a.submit()});return a},redraw:function(){var a=this.el.parentNode;a&&(this.render(),
this.updateDom(function(){$(a).empty().append(this.el)},this))},cancel:function(a){a&&a.preventDefault()&&a.preventDefault();this.trigger("cancel")},submit:function(){var a={},b=this;b.$el.find("input").each(function(){if(this.checked)a[this.name]=this.value});if(!_.isEmpty(a))a.forum=b.model.get("forum"),DISQUS.api.call("blacklists/add.json",{method:"POST",data:a,success:function(){b.trigger("success")}})}}),D=j.extend({events:{keyup:"handleKeychange",paste:"handleKeychange"},render:function(){this.el.tagName===
"TEXTAREA"&&this.$el.autoresize({maxHeight:350});this.$el.on("resize",_.debounce(_.bind(this.updateDom,this,function(){}),300));return this},resize:function(){this.$el.trigger("paste")},get:function(){return this.$el.val()},set:function(a){this.$el.val(a)},clear:function(){this.set("")},focus:function(){this.el.focus()},handleKeychange:function(){this.trigger("keychange")}}),y=D.extend({events:{keyup:"handleKeychange",paste:"handleKeychange"},initialize:function(a){a=a||{};this.thread=a.thread;this.mentionsCache=
new g.UserCollection;this.suggestions=new ba({thread:a.thread,mentions:this.mentionsCache});this.placeholder="";this.suggestions.on("select",this.insertMention,this);this.reset()},reset:function(){this.anchorOffset=this.anchorNode=null;this.anchorLength=0;this.suggestions.clear()},handleKeychange:function(){this.trigger("keychange");this.$el.trigger("resize")},render:function(){var a=this.el.getAttribute("placeholder"),b=this.el.value,d=document.createElement("div");_.extend(d,{className:"textarea",
contentEditable:!0,tabIndex:this.el.tabIndex});d.setAttribute("role","textbox");d.setAttribute("aria-multiline","true");d.style.overflow="auto";d.style.maxHeight="350px";var e=this.el.parentNode;e.replaceChild(d,this.el);this.setElement(d);this.bindKeyEvents();e.appendChild(this.suggestions.el);this.content=new Editable(this.el,!0,{getHtmlElements:_.bind(this.getHtmlElements,this)});this.set(b);D.prototype.render.call(this);if(a)this.placeholder='<span class="placeholder">'+a+"</span>",this.content.text()||
this.$el.html(this.placeholder),a=_.bind(function(){this.isPlaceholder()&&this.set("");this.el.focus()},this),this.$el.on("focus focusin",_.debounce(a,50)),this.$el.on("blur",_.bind(function(){this.content.text()===""&&this.setPlaceholder()},this));return this},getHtmlElements:function(a){if(!a)return a;var b=[a],a=this.getMentionNodes(a);_.each(a,function(a,c){for(var d=0;d<b.length;d++){var e=b[d],f=d,g;if(_.isString(e)){for(;(g=e.indexOf(c))>-1;)g>0&&b.splice(d++,0,e.substring(0,g)),b.splice(d++,
0,a.cloneNode(!0)),e=e.substring(g+c.length);e&&e!==b[f]&&b.splice(d++,0,e);f!==d&&b.splice(d,1)}}});return b=_.map(b,function(a){return _.isString(a)?document.createTextNode(a):a})},getMentionNodes:function(a){var b=y.MENTIONS_RE_GROUPED,d={};b.lastIndex=0;for(var e=b.exec(a);e;){var f=e[1],g=this.thread.users.find(function(a){return a.get("username")===f||a.get("emailHash")===f});if(g){var h=y.getMentionDom(g);d[e[0]]=h;this.updateCache(g,g.cid)}e=b.exec(a)}return d},isPlaceholder:function(){return this.$el.find(".placeholder").length!==
0},setPlaceholder:function(){this.$el.html(this.placeholder)},bindKeyEvents:function(){this.$el.on("keydown",_.bind(function(a){switch(a.keyCode){case 9:this.suggestions.active&&(this.suggestions.select(),a.preventDefault(),a.stopPropagation());break;case 10:case 13:case 38:case 40:this.suggestions.active&&(a.preventDefault(),a.stopPropagation())}},this));var a=_.throttle(_.bind(this.suggest,this),500);this.$el.on("keyup",_.bind(function(b){b.preventDefault();b.stopPropagation();this.checkExistingMentions();
switch(b.keyCode){case 50:if(!b.shiftKey)break;this.start(b);break;case 10:case 13:this.suggestions.select();break;case 27:this.reset(b);break;case 38:this.suggestions.move("up");break;case 40:this.suggestions.move("down");break;default:a(b)}},this))},start:function(){this.reset();this.suggest()},suggest:function(){this.suggestions.suggest(this.parseSearchTerms())},insertMention:function(a){var b=this.thread.users.get(a);this.selectSearchString(b);this.updateCache(b,a);this.content.insertNode(y.getMentionDom(b));
a=this.$el.find("span[data-cid]");_.each(a,function(a){if(a.contentEditable!==!1)a.contentEditable=!1})},updateCache:function(a,b){this.mentionsCache.get(b)||this.mentionsCache.add(a)},selectSearchString:function(){this.content.selectNodeText(this.anchorNode,this.anchorOffset-1,this.anchorOffset+this.anchorLength)},get:function(){var a=this,b=y.isMention;if(this.isPlaceholder())return"";return this.content.text(function(d){return b(d,!0)?a.mentionToText(d):null})},set:function(a){this.content.setText(a);
this.resize()},clear:function(){D.prototype.clear.call(this);this.setPlaceholder();_.defer(function(a){a.updateDom(function(){a.el.blur();a.$el.trigger("blur")})},this)},parseSearchTerms:function(){var a=this.content.selectedTextNode(),b=a?a.nodeValue:"",d=Editable.normalizeSpace;if(b){var e=this.content.selectedTextNodeOffset(a),f=Editable.normalizeSpace(b.slice(0,e).split("").reverse().join("")).indexOf("@");if(f===-1)return null;this.anchorNode=a;this.anchorOffset=e-f;this.anchorLength=f;if(a=
d(b.slice(this.anchorOffset-1,e)).match(y.MENTIONS_RE))return a[0].slice(1).split(" ");if(f===0)return[""]}},checkExistingMentions:function(){var a=Editable.normalizeSpace,b=this.$el.find("span"),b=_.filter(b,y.isMention),d=this.mentionsCache,e={};_.each(b,function(b){var f=$(b).attr("data-cid"),i=_.reduce(this.content.getTextNodes(b),function(b,d){return b+a(d.nodeValue)},""),g=d.get(f);g&&g.get("name")!==i?(this.mentionsCache.remove(g),this.content.removeNode(b),this.content.insertHTML(" "),this.reset()):
e[f]=b},this);d.each(function(a){e[a.cid]||d.remove(a)})},mentionToText:function(a){var b=this.mentionsCache.get($(a).attr("data-cid")),a=a.innerText||a.textContent;b&&(a=b.get("username")||b.get("emailHash"));return["@",a,":disqus"].join("")}},{MENTIONS_RE:/@\w+\s?(?:\w+\s?){0,5}(?:\w+)?$/,MENTIONS_RE_GROUPED:/@([\d\w]+)\s?(\:\s?(\w+))?/gi,isMention:function(a,b){var d;do{d=$(a);if(d.hasClass("mention")&&d.attr("data-cid"))return!0;a=a.parentElement}while(b&&a);return!1},getMentionDom:function(a){var b=
document.createDocumentFragment(),d=document.createElement("span"),e=document.createElement("span"),f=document.createTextNode(a.get("name")||a.get("username"));d.setAttribute("contenteditable",!0);e.setAttribute("contenteditable",!1);e.setAttribute("data-cid",a.cid);e.className="mention";e.appendChild(f);d.appendChild(e);b.appendChild(d);b.appendChild(document.createTextNode(" "));return b}}),ba=Backbone.View.extend({events:{"click li":"onclick"},initialize:function(a){this.active=!1;this.thread=
a.thread;this.mentionsCache=a.mentions},suggest:function(a){a=this.findMatches(a);if(!a||!a.length)return void this.clear();this.active=!0;this.el.innerHTML=DISQUS.renderBlock("suggestions",{users:_.map(a,function(a){return _.extend(a.toJSON(),{cid:a.cid})})});this.$el.find("li[data-cid]").first().addClass("active")},clear:function(){this.active=!1;this.el.innerHTML=""},onclick:function(a){this.select($(a.currentTarget).attr("data-cid"))},findMatches:function(a){if(a&&a.length){for(var b=RegExp(a.join(" ").replace(/[^\w\s]/,
""),"i"),d=ba.MAX_SUGGESTIONS,e=this.thread.users,f=[],g=0,h,a=a.length===1&&a[0]===""?function(){return!0}:function(a){return b.test(a.get("name"))||b.test(h.get("username"))},g=0;g<e.models.length&&f.length<d;g++)h=e.models[g],this.mentionsCache.get(h.cid)||a(h)&&f.push(h);return f}},select:function(a){this.active&&(a||(a=this.$el.find(".active").attr("data-cid")),this.trigger("select",a),this.clear())},move:function(a){if(this.active){var b=this.$el.find(".active"),a=b[a==="up"?"previous":"next"]();
a.length&&a.attr("data-cid")&&(b.removeClass("active"),a.addClass("active"))}}},{MAX_SUGGESTIONS:5}),R=j.extend({tagName:"ul",className:"debug",initialize:function(a){this.values=a},render:function(){this.$el.empty();_.each(this.values,function(a,b){var d=document.createElement("li");d.innerHTML="<strong>"+b+"</strong>: "+a;this.$el.append(d)},this);return this}}),fa=Backbone.View.extend({events:{"click [data-nav]":"_navTo"},initialize:function(){this.prevDestination=this.activeNav()},_navTo:function(a){a.preventDefault();
a=$(a.target);a=a.is("[data-nav]")?a:a.closest("[data-nav]");a=a.attr("data-nav");this.prevDestination!=a&&this.navTo(a)},navTo:function(a){this.prevDestination=a;var b=this.$el.find("[data-nav="+a+"]").parent();b.siblings("li").removeClass("active");b.addClass("active");this.trigger("nav",a)},activeNav:function(){if(this.prevDestination!=null)return this.prevDestination;return this.$el.find(".active [data-nav]").attr("data-nav")},clear:function(){this.$el.find("li").removeClass("active");this.prevDestination=
null}}),P=Backbone.View.extend({events:{"click [rel=nofollow]":"sendLinkForInspection"},initialize:function(){this.link=null;this.busy=!1;this.timeoutId=null;this.timeout=1E3;this.token=1;this.on("option.timeout",function(a){this.timeout=a})},setLink:function(a){this.link=a;this.$link=$(this.link)},onAffiliatorResponse:function(b){b=b||{};if(b.token==this.token){a.off("affiliateLink",this.onAffilatorResponse);if(b.url)this.link.href=b.url;this.undelegateEvents();l.switches.enabled("next_use_jquery")?
this.$link.triggerClick():this.$link.click()}},sendLinkForInspection:function(b){if(b.currentTarget===this.link)return void b.preventDefault();var d=b.which&&b.which===1||b.button===0;if(b.ctrlKey||b.metaKey||b.altKey||b.shiftKey||!d)return!0;if(this.busy){a.off("affiliateLink");if(this.timeoutId&&window.clearTimeout)window.clearTimeout(this.timeoutId),this.timeoutId=null;this.token++}this.busy=!0;this.setLink(b.currentTarget);b.preventDefault();a.on("affiliateLink",this.onAffiliatorResponse,this);
a.sendHostMessage("affiliateLink",{token:this.token,url:this.link.href});b=_.bind(function(a){this.onAffiliatorResponse({token:a})},this,this.token);this.timeoutId=_.delay(b,this.timeout)}}),K=r.extend({events:{mousewheel:"handleScroll"},initialize:function(a){r.prototype.initialize.call(this,a);this._rendered=this._loading=this._fetched=!1;var b=a.model;this.model=b;this.session=a.session;this.likes=b.get("likes");this.hadLikes=!!this.likes;this.users=new g.UpvotersUserCollection([],{postId:b.get("id"),
threadId:b.get("thread")});this.users.on("reset",this.show,this);l.on("activeUserVoteUpdate",this.updateUserSet,this)},updateUserSet:function(a){if(this.model.get("id")===a){var a=this.session.user,b=this.likes,d=!1;this.likes=this.model.get("likes");if(this.model.get("userScore")>0){if(!this.session.isAnonymous())if(this.users.contains(a))return;else this.users.add(a);this.likes&&!b?(this._rendered=!1,this.show()):(a=this.likes-1-this.users.length,d=this.session.isAnonymous()?!!a:!0,this.addUser())}else this.users.remove(a),
this.removeUser(),this.likes||this.hide();this.moveTo(this.$target,d)}},addUser:function(){var a=this.session.user;this.session.isAnonymous()?this.updateGuestVotes():this.$listEl&&this.$listEl.length&&(this.$listEl.prepend(DISQUS.renderBlock("upvoter",_.extend({highlight:!0},a.toJSON()))),this.stopHighlightUsername())},removeUser:function(){var a=this.session.user;this.session.isAnonymous()?this.updateGuestVotes():(a=this.$el.find("[data-user="+a.get("id")+"]"),a.length&&a.remove())},stopHighlightUsername:_.debounce(function(){this.$el.find(".highlight").removeClass("highlight")},
1100),updateGuestVotes:function(){var a=this.$el.find("[data-role=guest]"),b=DISQUS.renderBlock("guestUpvoter",{guestCount:this.likes-this.users.length,guestAvatarUrl:DISQUS.urls.avatar.generic,highlight:a.length,users:{length:this.users.length}});a.length?(a.replaceWith(b),this.stopHighlightUsername()):this.$listEl&&this.$listEl.length&&this.$listEl.append(b)},render:function(){delete this.pointEl;this.setElement($(DISQUS.renderBlock("upvoters",{users:this.users.toJSON(),guestCount:this.likes-this.users.length,
guestAvatarUrl:DISQUS.urls.avatar.generic,isLoading:this._loading,highlight:!1})));r.prototype.render.call(this);this.scrollMeasure=this.$el.find(".scroll-measure");this.$listEl=this.$el.find(".upvoters ul")},handleScroll:function(a){var b=a.wheelDeltaY,d=this.$el.height(),e=this.scrollMeasure,f=e.height(),e=e.parent()[0].scrollTop;(e>=f-d&&b<0||e===0&&b>0)&&a.preventDefault()},show:function(){var a=m.getInstance();if(a.switches.enabled("next_upvoters_tooltip")&&this.likes&&!this.isVisible()){if(!this.hadLikes)this._fetched=
!0,this._loading=!1;if(this._fetched){if(this._loading)this._loading=this._rendered=!1,this.hide()}else this.users.fetch({reset:!0}),this._loading=this._fetched=!0;if(this._fetched&&!this._loading){var b=this.session.user;this.model.get("userScore")>0&&!this.session.isAnonymous()&&!this.users.contains(b)&&this.users.add(b);r.prototype.show.call(this);this.scrollMeasure&&this.scrollMeasure.dim().height>this.$el.dim().height&&this.$el.addClass("has-scroll");a.trigger("uiAction:upvotersCardShow")}}},
showPoint:function(a){if(!this.pointEl)this.pointEl=this.$el.find(".tooltip-point"),this.pointEl.removeClass("hidden");_.each(["tl","bl"],function(a){this.pointEl.removeClass("point-position-"+a)},this);this.pointEl.addClass("point-position-"+a)},moveTo:function(a,b){if(a){var d=r.POSITION_OFFSET,e=a.offset(),f=this.$el,g=f.dim(),h=m.getInstance().position,k=h.frameOffset.height;b&&(g.height+=f.find("li.user").dim().height+10);e.top-g.height-d>=0&&e.top-g.height+h.frameOffset.top>=h.pageOffset?(f.css({bottom:k-
e.top+d,top:"inherit"}),this.showPoint("bl")):(f.css({bottom:"inherit",top:e.top+d*2}),this.showPoint("tl"));f.css("left",e.left-d)}},handleShowProfile:d(function(a){r.prototype.handleShowProfile.call(this,a);m.getInstance().trigger("uiAction:showProfileFromUpvotes")})},{create:function(a){return r.create(a.postId,a,"UpvotersCard",K)}});return{Lounge:m,LoungeSubView:j,PostView:A,PostReplyView:x,FullscreenPostReplyView:L,PostEditView:M,UserMenuView:E,ThreadVotesView:w,ThreadSubscribeButton:v,QueuedPostView:G,
QueuedReplyView:Q,TypingUserView:U,CommunityView:T,TopThreadCollectionView:Z,TopUserCollectionView:aa,DashboardView:S,NotificationCollectionView:X,NotificationCountView:I,UserActivityCollectionView:t,NetworkActivityCollectionView:W,HoverCard:r,ProfileCard:H,ContextCard:J,UpvotersCard:K,CaptchaView:N,OutboundLinkHandler:P,AlertView:O,BlacklistView:V,ContentEditableView:y,DebugInfoView:R,AlertMixin:s}});
DISQUS.define("next.lounge.tracking",function(b){function d(b,d){var a=d.initialData,e=d.switches;_.isObject(a)&&!_.isEmpty(a)&&(d.session.once("identify",function(){var k=this.user.id;k&&h.overwrite({user_id:k});if(e.enabled("juggler_thread_onReady")){k={thread_slug:a.thread.slug,user_type:this.user.get("user_type")||"anon",referrer:b.document.referrer,theme:"next"};h.emit("init_embed",k);if(e.enabled("dark_jester")){var l=DISQUS.juggler.client("jester",!0);l.load(_.extend(h.copySettings(),{url:"http://referrer.disqus.com/juggler/event.js"}));
l.emit("init_embed",k)}g.init({forum:a.forum.id,features:a.features,session:this.user});d.session.on("change:id",function(a){g.setSession(a);g.trackEvent(a.id?"login":"logout")})}}),h.load({disable:!e.enabled("juggler_enabled"),url:"http://juggler.services.disqus.com/event.js",disableSSL:e.enabled("next_disable_ssl_juggler"),thread:a.thread.id,forum:a.forum.id,forum_id:a.forum.pk}),DISQUS.each({inViewport:function(){g.trackEvent("view_embed");d.off("inViewport")},"uiAction:createPost":function(a){d.session.user.id||
g.setSession("guest");a.get("parent")!=null?g.trackEvent("post_comment_reply"):g.trackEvent("post_comment")},"uiAction:postUpvote":function(){g.trackEvent("like_comment")},"uiAction:postDownvote":function(){g.trackEvent("dislike_comment")},"uiAction:upvotersCardShow":function(){g.trackEvent("upvoters_card_shown")},"uiAction:showProfileFromUpvotes":function(){g.trackEvent("upvoters_profile_click")},"uiAction:threadUpvote":function(){g.trackEvent("like_thread")},"uiAction:postShare":function(a){g.trackEvent("share_comment_"+
a)},"uiAction:threadShare":function(a){g.trackEvent("share_thread_"+a)},"uiAction:navigate":function(a){(a={community:"community",dashboard:"mydisqus",network:"mydisqus_network"}[a])&&g.trackEvent("open_"+a)},"uiAction:followUser":function(){g.trackEvent("follow_user")},"uiAction:openLogin":function(a){g.trackEvent("open_login_"+a)},"uiAction:finishRegistrationEmbed":function(){g.trackEvent("finish_registration_embed")},"uiAction:finishRegistrationWindow":function(){g.trackEvent("finish_registration_window")},
"uiAction:finishAccountComplete":function(){g.trackEvent("finish_account_complete")}},function(a,b){d.on(b,a)}))}var e=DISQUS.use("next.intelligence"),h=DISQUS.juggler.client("juggler",!0),g=new e.Intelligence;return{init:function(e){d(b,e)}}});var _comscore,_gaq;
(function(b){var d="",d="UA-1410476-6",e=b.getElementsByTagName("script")[0],h=e.parentNode,g=b.location.protocol=="https:";_comscore=_comscore||[];_comscore.push({c1:"7",c2:"10137436",c3:"1"});var f=document.createElement("script");f.async=!0;f.src=(g?"https://sb":"http://b")+".scorecardresearch.com/beacon.js";h.insertBefore(f,e);_gaq=_gaq||[];_gaq.push(["_setAccount",d]);_gaq.push(["_setDomainName",".disqus.com"]);b=b.createElement("script");b.type="text/javascript";b.async=!0;b.src=(g?"https://ssl":
"http://www")+".google-analytics.com/ga.js";h.insertBefore(b,e)})(document);
(function(){DISQUS.log=function(){var b=DISQUS.next.views.Lounge.getInstance();window.console&&b&&b.switches&&b.switches.enabled("next_logging")&&(window.console.log.apply?window.console.log.apply(window.console,arguments):window.console.log(Array.prototype.slice.call(arguments,0).join(" ")))};DISQUS.logError=function(){var b=DISQUS.next.views.Lounge.getInstance(),d=Array.prototype.slice.call(arguments,0);DISQUS.log.apply(DISQUS,d);b.switches&&b.switches.enabled("next_raven")&&b.states.ravenConfigured&&
Raven.captureMessage({name:"DISQUS.logError",message:d.join(" ")})};$(document).ready(function(){function b(){$(".dropdown").removeClass("open")}$("html").on("click",b);$("body").delegate("[data-toggle]","click",function(d){d.stopPropagation();d.preventDefault();var d=$(d.currentTarget),d=d.closest("."+d.attr("data-toggle")),e=d.attr("data-dropdown")!="disabled"&&!d.hasClass("open");d.attr("data-dropdown","enabled");b();e&&d.addClass("open")});DISQUS.Bus.on("window.click",b)})})();