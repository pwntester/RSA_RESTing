<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>22.18. Gremlin Plugin</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.76.1" /><link rel="home" href="index.html" title="The Neo4j Manual v1.9.6" /><link rel="up" href="rest-api.html" title="Chapter 22. REST API" /><link rel="prev" href="rest-api-wadl-support.html" title="22.17. WADL Support" /><link rel="next" href="deprecations.html" title="Chapter 23. Deprecations" /><link rel="preface" href="preface.html" title="Preface" /><link rel="part" href="introduction.html" title="Part I. Introduction" /><link rel="chapter" href="introduction-highlights.html" title="Chapter 1. Neo4j Highlights" /><link rel="chapter" href="graphdb-concepts.html" title="Chapter 2. Graph Database Concepts" /><link rel="chapter" href="graphdb-neo4j.html" title="Chapter 3. The Neo4j Graph Database" /><link rel="part" href="tutorials.html" title="Part II. Tutorials" /><link rel="chapter" href="tutorials-java-embedded.html" title="Chapter 4. Using Neo4j embedded in Java applications" /><link rel="chapter" href="tutorials-rest.html" title="Chapter 5. Neo4j Remote Client Libraries" /><link rel="chapter" href="tutorial-traversal.html" title="Chapter 6. The Traversal Framework" /><link rel="chapter" href="data-modeling-examples.html" title="Chapter 7. Data Modeling Examples" /><link rel="chapter" href="languages.html" title="Chapter 8. Languages" /><link rel="chapter" href="server-extending.html" title="Chapter 9. Extending the Neo4j Server" /><link rel="part" href="cypher-query-lang.html" title="Part III. Cypher Query Language" /><link rel="chapter" href="cypher-intro.html" title="Chapter 10. Introduction" /><link rel="chapter" href="query-syntax.html" title="Chapter 11. Syntax" /><link rel="chapter" href="query-read.html" title="Chapter 12. Reading Clauses" /><link rel="chapter" href="query-write.html" title="Chapter 13. Writing Clauses" /><link rel="chapter" href="query-function.html" title="Chapter 14. Functions" /><link rel="chapter" href="examples-from-sql-to-cypher.html" title="Chapter 15. From SQL to Cypher" /><link rel="part" href="reference-documentation.html" title="Part IV. Reference" /><link rel="chapter" href="capabilities.html" title="Chapter 16. Capabilities" /><link rel="chapter" href="transactions.html" title="Chapter 17. Transaction Management" /><link rel="chapter" href="import.html" title="Chapter 18. Data Import" /><link rel="chapter" href="indexing.html" title="Chapter 19. Indexing" /><link rel="chapter" href="graph-algo.html" title="Chapter 20. Graph Algorithms" /><link rel="chapter" href="server.html" title="Chapter 21. Neo4j Server" /><link rel="chapter" href="rest-api.html" title="Chapter 22. REST API" /><link rel="chapter" href="deprecations.html" title="Chapter 23. Deprecations" /><link rel="part" href="operations.html" title="Part V. Operations" /><link rel="chapter" href="deployment.html" title="Chapter 24. Installation &amp; Deployment" /><link rel="chapter" href="embedded-configuration.html" title="Chapter 25. Configuration &amp; Performance" /><link rel="chapter" href="ha.html" title="Chapter 26. High Availability" /><link rel="chapter" href="operations-backup.html" title="Chapter 27. Backup" /><link rel="chapter" href="operations-security.html" title="Chapter 28. Security" /><link rel="chapter" href="operations-monitoring.html" title="Chapter 29. Monitoring" /><link rel="part" href="tools.html" title="Part VI. Tools" /><link rel="chapter" href="tools-webadmin.html" title="Chapter 30. Web Interface" /><link rel="chapter" href="shell.html" title="Chapter 31. Neo4j Shell" /><link rel="part" href="community.html" title="Part VII. Community" /><link rel="chapter" href="community-support.html" title="Chapter 32. Community Support" /><link rel="chapter" href="community-contributing.html" title="Chapter 33. Contributing to Neo4j" /><link rel="appendix" href="manpages.html" title="Appendix A. Manpages" /><link rel="refentry" href="re01.html" title="neo4j" /><link rel="refentry" href="re02.html" title="neo4j-shell" /><link rel="refentry" href="re03.html" title="neo4j-backup" /><link rel="refentry" href="re04.html" title="neo4j-arbiter" /><link rel="subsection" href="gremlin-plugin.html#rest-api-send-a-gremlin-script---url-encoded" title="22.18.1. Send a Gremlin Script - URL encoded" /><link rel="subsection" href="gremlin-plugin.html#rest-api-load-a-sample-graph" title="22.18.2. Load a sample graph" /><link rel="subsection" href="gremlin-plugin.html#rest-api-sort-a-result-using-raw-groovy-operations" title="22.18.3. Sort a result using raw Groovy operations" /><link rel="subsection" href="gremlin-plugin.html#rest-api-send-a-gremlin-script---json-encoded-with-table-results" title="22.18.4. Send a Gremlin Script - JSON encoded with table results" /><link rel="subsection" href="gremlin-plugin.html#rest-api-returning-nested-pipes" title="22.18.5. Returning nested pipes" /><link rel="subsection" href="gremlin-plugin.html#rest-api-set-script-variables" title="22.18.6. Set script variables" /><link rel="subsection" href="gremlin-plugin.html#rest-api-send-a-gremlin-script-with-variables-in-a-json-map" title="22.18.7. Send a Gremlin Script with variables in a JSON Map" /><link rel="subsection" href="gremlin-plugin.html#rest-api-return-paths-from-a-gremlin-script" title="22.18.8. Return paths from a Gremlin script" /><link rel="subsection" href="gremlin-plugin.html#rest-api-send-an-arbitrary-groovy-script---lucene-sorting" title="22.18.9. Send an arbitrary Groovy script - Lucene sorting" /><link rel="subsection" href="gremlin-plugin.html#rest-api-emit-a-sample-graph" title="22.18.10. Emit a sample graph" /><link rel="subsection" href="gremlin-plugin.html#rest-api-hyperedges---find-user-roles-in-groups" title="22.18.11. HyperEdges - find user roles in groups" /><link rel="subsection" href="gremlin-plugin.html#rest-api-group-count" title="22.18.12. Group count" /><link rel="subsection" href="gremlin-plugin.html#rest-api-collect-multiple-traversal-results" title="22.18.13. Collect multiple traversal results" /><link rel="subsection" href="gremlin-plugin.html#rest-api-collaborative-filtering" title="22.18.14. Collaborative filtering" /><link rel="subsection" href="gremlin-plugin.html#rest-api-chunking-and-offsetting-in-gremlin" title="22.18.15. Chunking and offsetting in Gremlin" /><link rel="subsection" href="gremlin-plugin.html#rest-api-this-example-shows-how-to-modify-the-graph-while-traversing-it" title="22.18.16. This example shows how to modify the graph while traversing it" /><link rel="subsection" href="gremlin-plugin.html#rest-api-flow-algorithms-with-gremlin" title="22.18.17. Flow algorithms with Gremlin" /><link rel="subsection" href="gremlin-plugin.html#rest-api-script-execution-errors" title="22.18.18. Script execution errors" /><link rel="copyright" href="ln-idp1112768.html" title="License: Creative Commons 3.0" />


<!-- favicon -->

<link rel="shortcut icon" href="http://neo4j.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://neo4j.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/neo.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushCypher.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>
<script type="text/javascript" src="js/shBrushProperties.js"></script>

<!-- activate when needed
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
-->
 
<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Replace SVG for browsers that lack support. -->
<script type="text/javascript" src="js/svgreplacer.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Version -->

<script type="text/javascript" src="js/version.js"></script>

<!-- Offline Sidebar -->

<script type="text/javascript" src="js/sidebar.js"></script>


<div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">The Neo4j Manual</a></span> &gt; <span class="breadcrumb-link"><a href="reference-documentation.html">Reference</a></span> &gt; <span class="breadcrumb-link"><a href="rest-api.html">REST API</a></span> &gt; <span class="breadcrumb-node">Gremlin Plugin</span></div></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="rest-api-wadl-support.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="deprecations.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="gremlin-plugin"></a>22.18. Gremlin Plugin</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="gremlin-plugin.html#rest-api-send-a-gremlin-script---url-encoded">22.18.1. Send a Gremlin Script - URL encoded</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-load-a-sample-graph">22.18.2. Load a sample graph</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-sort-a-result-using-raw-groovy-operations">22.18.3. Sort a result using raw Groovy operations</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-send-a-gremlin-script---json-encoded-with-table-results">22.18.4. Send a Gremlin Script - JSON encoded with table results</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-returning-nested-pipes">22.18.5. Returning nested pipes</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-set-script-variables">22.18.6. Set script variables</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-send-a-gremlin-script-with-variables-in-a-json-map">22.18.7. Send a Gremlin Script with variables in a JSON Map</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-return-paths-from-a-gremlin-script">22.18.8. Return paths from a Gremlin script</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-send-an-arbitrary-groovy-script---lucene-sorting">22.18.9. Send an arbitrary Groovy script - Lucene sorting</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-emit-a-sample-graph">22.18.10. Emit a sample graph</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-hyperedges---find-user-roles-in-groups">22.18.11. HyperEdges - find user roles in groups</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-group-count">22.18.12. Group count</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-collect-multiple-traversal-results">22.18.13. Collect multiple traversal results</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-collaborative-filtering">22.18.14. Collaborative filtering</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-chunking-and-offsetting-in-gremlin">22.18.15. Chunking and offsetting in Gremlin</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-this-example-shows-how-to-modify-the-graph-while-traversing-it">22.18.16. This example shows how to modify the graph while traversing it</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-flow-algorithms-with-gremlin">22.18.17. Flow algorithms with Gremlin</a></span></dt><dt><span class="section"><a href="gremlin-plugin.html#rest-api-script-execution-errors">22.18.18. Script execution errors</a></span></dt></dl></div><div class="informalfigure"><a class="ulink" href="images/gremlin-logo.png" target="_top">
<span class="inlinemediaobject"><img src="images/gremlin-logo.png" alt="gremlin-logo.png" /></span>
</a></div><p><a class="ulink" href="http://gremlin.tinkerpop.com" target="_top">Gremlin</a> is a Groovy based Graph Traversal Language. It provides a very expressive way of explicitly scripting traversals through a Neo4j graph.</p><p>The Neo4j Gremlin Plugin provides an endpoint to send Gremlin scripts to the Neo4j Server.
The scripts are executed on the server database and the results are returned as Neo4j Node and Relationship representations.
This keeps the types throughout the REST API consistent.
The results are quite verbose when returning Neo4j <code class="literal">Node</code>,
<code class="literal">Relationship</code> or <code class="literal">Graph</code> representations.
On the other hand, just return properties like in the <a class="xref" href="gremlin-plugin.html#rest-api-send-a-gremlin-script---json-encoded-with-table-results" title="22.18.4. Send a Gremlin Script - JSON encoded with table results">Section 22.18.4, “Send a Gremlin Script - JSON encoded with table results”</a>
example for responses tailored to specific needs.</p><div class="warning" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Warning"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="images/icons/admon/warning.png" /></td><th align="left">Warning</th></tr><tr><td align="left" valign="top"><p>The Gremlin plugin lets you execute arbitrary Groovy code under the hood. In hosted and open environments, this can constitute a security risk.
In these case, consider using declarative approaches like <a class="xref" href="cypher-query-lang.html" title="Part III. Cypher Query Language">Part III, “Cypher Query Language”</a> or write your own server side plugin executing the
interesting Gremlin or Java routines, see <a class="xref" href="server-plugins.html" title="9.1. Server Plugins">Section 9.1, “Server Plugins”</a> or secure your server, see <a class="xref" href="security-server.html" title="28.1. Securing access to the Neo4j Server">Section 28.1, “Securing access to the Neo4j Server”</a>.</p></td></tr></table></div><div class="tip" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/icons/admon/tip.png" /></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>When returning results from pipes like <code class="literal">g.v(0).in()</code>, make sure to iterate through the results in order not to return the pipe object but its content, like <code class="literal">g.v(0).in().iterate()</code>. For more caveats, see <a class="ulink" href="https://github.com/tinkerpop/gremlin/wiki/Troubleshooting" target="_top">Gremlin Troubleshooting</a></p></td></tr></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-send-a-gremlin-script---url-encoded"></a>22.18.1. Send a Gremlin Script - URL encoded</h3></div></div></div><p>Scripts can be sent as URL-encoded In this example, the graph has been
autoindexed by Neo4j, so we can look up the name property on nodes.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.idx('node_auto_index')[[name:'I']].out</pre><div class="figure"><a id="idp13276976"></a><p class="title"><strong>Figure 22.56. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Send-a-Gremlin-Script---URL-encoded.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Send-a-Gremlin-Script---URL-encoded.svg" alt="Final-Graph-Send-a-Gremlin-Script---URL-encoded.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/x-www-form-urlencoded</code>
</li></ul></div><pre class="programlisting brush: javascript">script=g.idx%28%27node_auto_index%27%29%5B%5Bname%3A%27I%27%5D%5D.out</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/13/relationships/out",
  "data" : {
    "name" : "you"
  },
  "traverse" : "http://localhost:7474/db/data/node/13/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/13/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/13/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/13",
  "properties" : "http://localhost:7474/db/data/node/13/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/13/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/13/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/13/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/13/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/13/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/13/relationships/in/{-list|&amp;|types}"
} ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-load-a-sample-graph"></a>22.18.2. Load a sample graph</h3></div></div></div><p>Importing a graph from a <a class="ulink" href="http://graphml.graphdrawing.org/" target="_top">GraphML</a> file can
be achieved through the Gremlin GraphMLReader. The following script
imports a small GraphML file from an URL into Neo4j, resulting in the
depicted graph. The underlying database is auto-indexed, see <a class="xref" href="auto-indexing.html" title="19.12. Automatic Indexing">Section 19.12, “Automatic Indexing”</a>
so the script can return the imported node by index lookup.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.clear()
g.loadGraphML('file:/var/lib/jenkins/jobs/neo4j-1.9-release-candidate/workspace/target/gremlin-plugin/target/test-classes/graphml.xml')
g.idx('node_auto_index')[[name:'you']]</pre><div class="figure"><a id="idp13304544"></a><p class="title"><strong>Figure 22.57. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Load-a-sample-graph.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Load-a-sample-graph.svg" alt="Final-Graph-Load-a-sample-graph.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.clear();g.loadGraphML('file:/var/lib/jenkins/jobs/neo4j-1.9-release-candidate/workspace/target/gremlin-plugin/target/test-classes/graphml.xml');g.idx('node_auto_index')[[name:'you']];",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/45/relationships/out",
  "data" : {
    "name" : "you"
  },
  "traverse" : "http://localhost:7474/db/data/node/45/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/45/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/45/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/45",
  "properties" : "http://localhost:7474/db/data/node/45/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/45/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/45/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/45/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/45/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/45/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/45/relationships/in/{-list|&amp;|types}"
} ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-sort-a-result-using-raw-groovy-operations"></a>22.18.3. Sort a result using raw Groovy operations</h3></div></div></div><p>The following script returns a sorted list of all nodes connected via
outgoing relationships to node 1, sorted by their <code class="literal">name</code>-property.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.idx('node_auto_index')[[name:'I']].out.sort{it.name}</pre><div class="figure"><a id="idp13331312"></a><p class="title"><strong>Figure 22.58. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Sort-a-result-using-raw-Groovy-operations.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Sort-a-result-using-raw-Groovy-operations.svg" alt="Final-Graph-Sort-a-result-using-raw-Groovy-operations.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.idx('node_auto_index')[[name:'I']].out.sort{it.name}",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/66/relationships/out",
  "data" : {
    "name" : "him"
  },
  "traverse" : "http://localhost:7474/db/data/node/66/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/66/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/66/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/66",
  "properties" : "http://localhost:7474/db/data/node/66/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/66/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/66/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/66/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/66/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/66/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/66/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/65/relationships/out",
  "data" : {
    "name" : "you"
  },
  "traverse" : "http://localhost:7474/db/data/node/65/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/65/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/65/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/65",
  "properties" : "http://localhost:7474/db/data/node/65/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/65/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/65/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/65/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/65/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/65/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/65/relationships/in/{-list|&amp;|types}"
} ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-send-a-gremlin-script---json-encoded-with-table-results"></a>22.18.4. Send a Gremlin Script - JSON encoded with table results</h3></div></div></div><p>To send a Script JSON encoded, set the payload Content-Type Header. In
this example, find all the things that my friends like, and return a
table listing my friends by their name, and the names of the things they
like in a table with two columns, ignoring the third named step variable
<code class="literal">I</code>. Remember that everything in Gremlin is an iterator - in order to
populate the result table <code class="literal">t</code>, iterate through the pipes with
<code class="literal">iterate()</code>.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">t= new Table()
g.v(49).as('I').out('know').as('friend').out('like').as('likes').table(t,['friend','likes']){it.name}{it.name}.iterate()
t</pre><div class="figure"><a id="idp13361712"></a><p class="title"><strong>Figure 22.59. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Send-a-Gremlin-Script---JSON-encoded-with-table-results.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Send-a-Gremlin-Script---JSON-encoded-with-table-results.svg" alt="Final-Graph-Send-a-Gremlin-Script---JSON-encoded-with-table-results.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "t= new Table();g.v(49).as('I').out('know').as('friend').out('like').as('likes').table(t,['friend','likes']){it.name}{it.name}.iterate();t;",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "columns" : [ "friend", "likes" ],
  "data" : [ [ "Joe", "cats" ], [ "Joe", "dogs" ] ]
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-returning-nested-pipes"></a>22.18.5. Returning nested pipes</h3></div></div></div><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.v(23).as('I').out('know').as('friend').out('like').as('likes').table(new Table()){it.name}{it.name}.cap</pre><div class="figure"><a id="idp13386112"></a><p class="title"><strong>Figure 22.60. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-returning-nested-pipes.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-returning-nested-pipes.svg" alt="Final-Graph-returning-nested-pipes.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.v(23).as('I').out('know').as('friend').out('like').as('likes').table(new Table()){it.name}{it.name}.cap;",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ {
  "data" : [ [ "I", "Joe", "cats" ], [ "I", "Joe", "dogs" ] ],
  "columns" : [ "I", "friend", "likes" ]
} ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-set-script-variables"></a>22.18.6. Set script variables</h3></div></div></div><p>To set variables in the bindings for the Gremlin Script Engine on the
server, you can include a <code class="literal">params</code> parameter with a String representing a
JSON map of variables to set to initial values. These can then be
accessed as normal variables within the script.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">meaning_of_life</pre><div class="figure"><a id="idp13411600"></a><p class="title"><strong>Figure 22.61. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Set-script-variables.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Set-script-variables.svg" alt="Final-Graph-Set-script-variables.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "meaning_of_life",
  "params" : {
    "meaning_of_life" : 42.0
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">42.0</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-send-a-gremlin-script-with-variables-in-a-json-map"></a>22.18.7. Send a Gremlin Script with variables in a JSON Map</h3></div></div></div><p>Send a Gremlin Script, as JSON payload and additional parameters</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.v(me).out</pre><div class="figure"><a id="idp13435984"></a><p class="title"><strong>Figure 22.62. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Send-a-Gremlin-Script-with-variables-in-a-JSON-Map.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Send-a-Gremlin-Script-with-variables-in-a-JSON-Map.svg" alt="Final-Graph-Send-a-Gremlin-Script-with-variables-in-a-JSON-Map.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.v(me).out",
  "params" : {
    "me" : "32"
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/31/relationships/out",
  "data" : {
    "name" : "you"
  },
  "traverse" : "http://localhost:7474/db/data/node/31/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/31/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/31/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/31",
  "properties" : "http://localhost:7474/db/data/node/31/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/31/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/31/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/31/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/31/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/31/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/31/relationships/in/{-list|&amp;|types}"
} ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-return-paths-from-a-gremlin-script"></a>22.18.8. Return paths from a Gremlin script</h3></div></div></div><p>The following script returns paths. Paths in Gremlin consist of the pipes
that make up the path from the starting pipes. The server is returning
JSON representations of their content as a nested list.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.v(3).out.name.paths</pre><div class="figure"><a id="idp13461936"></a><p class="title"><strong>Figure 22.63. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Return-paths-from-a-Gremlin-script.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Return-paths-from-a-Gremlin-script.svg" alt="Final-Graph-Return-paths-from-a-Gremlin-script.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.v(3).out.name.paths",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ [ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/3/relationships/out",
  "data" : {
    "name" : "I"
  },
  "traverse" : "http://localhost:7474/db/data/node/3/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/3/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/3/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/3",
  "properties" : "http://localhost:7474/db/data/node/3/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/3/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/3/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/3/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/3/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/3/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/3/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/1/relationships/out",
  "data" : {
    "name" : "you"
  },
  "traverse" : "http://localhost:7474/db/data/node/1/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/1/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/1/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/1",
  "properties" : "http://localhost:7474/db/data/node/1/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/1/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/1/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/1/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/1/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/1/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/1/relationships/in/{-list|&amp;|types}"
}, "you" ], [ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/3/relationships/out",
  "data" : {
    "name" : "I"
  },
  "traverse" : "http://localhost:7474/db/data/node/3/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/3/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/3/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/3",
  "properties" : "http://localhost:7474/db/data/node/3/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/3/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/3/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/3/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/3/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/3/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/3/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/2/relationships/out",
  "data" : {
    "name" : "him"
  },
  "traverse" : "http://localhost:7474/db/data/node/2/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/2/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/2/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/2",
  "properties" : "http://localhost:7474/db/data/node/2/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/2/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/2/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/2/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/2/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/2/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/2/relationships/in/{-list|&amp;|types}"
}, "him" ] ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-send-an-arbitrary-groovy-script---lucene-sorting"></a>22.18.9. Send an arbitrary Groovy script - Lucene sorting</h3></div></div></div><p>This example demonstrates that you via the Groovy runtime embedded with
the server have full access to all of the servers Java APIs. The below
example creates Nodes in the database both via the Blueprints and the
Neo4j API indexes the nodes via the native Neo4j Indexing API constructs
a custom Lucene sorting and searching returns a Neo4j IndexHits result
iterator.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">'******** Additional imports *********'
import org.neo4j.graphdb.index.*
import org.neo4j.graphdb.*
import org.neo4j.index.lucene.*
import org.apache.lucene.search.*

'**** Blueprints API methods on the injected Neo4jGraph at variable g ****'
meVertex = g.addVertex([name:'me'])
meNode = meVertex.getRawVertex()

'*** get the Neo4j raw instance ***'
neo4j = g.getRawGraph()


'******** Neo4j API methods: *********'
tx = neo4j.beginTx()
 youNode = neo4j.createNode()
 youNode.setProperty('name','you')
 youNode.createRelationshipTo(meNode,DynamicRelationshipType.withName('knows'))

'*** index using Neo4j APIs ***'
 idxManager = neo4j.index()
 personIndex = idxManager.forNodes('persons')
 personIndex.add(meNode,'name',meNode.getProperty('name'))
 personIndex.add(youNode,'name',youNode.getProperty('name'))
tx.success()
tx.finish()


'*** Prepare a custom Lucene query context with Neo4j API ***'
query = new QueryContext( 'name:*' ).sort( new Sort(new SortField( 'name',SortField.STRING, true ) ) )
results = personIndex.query( query )</pre><div class="figure"><a id="idp13493696"></a><p class="title"><strong>Figure 22.64. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Send-an-arbitrary-Groovy-script---Lucene-sorting.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Send-an-arbitrary-Groovy-script---Lucene-sorting.svg" alt="Final-Graph-Send-an-arbitrary-Groovy-script---Lucene-sorting.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "'******** Additional imports *********';import org.neo4j.graphdb.index.*;import org.neo4j.graphdb.*;import org.neo4j.index.lucene.*;import org.apache.lucene.search.*;;'**** Blueprints API methods on the injected Neo4jGraph at variable g ****';meVertex = g.addVertex([name:'me']);meNode = meVertex.getRawVertex();;'*** get the Neo4j raw instance ***';neo4j = g.getRawGraph();;;'******** Neo4j API methods: *********';tx = neo4j.beginTx(); youNode = neo4j.createNode(); youNode.setProperty('name','you'); youNode.createRelationshipTo(meNode,DynamicRelationshipType.withName('knows'));;'*** index using Neo4j APIs ***'; idxManager = neo4j.index(); personIndex = idxManager.forNodes('persons'); personIndex.add(meNode,'name',meNode.getProperty('name')); personIndex.add(youNode,'name',youNode.getProperty('name'));tx.success();tx.finish();;;'*** Prepare a custom Lucene query context with Neo4j API ***';query = new QueryContext( 'name:*' ).sort( new Sort(new SortField( 'name',SortField.STRING, true ) ) );results = personIndex.query( query );",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/20/relationships/out",
  "data" : {
    "name" : "you"
  },
  "traverse" : "http://localhost:7474/db/data/node/20/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/20/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/20/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/20",
  "properties" : "http://localhost:7474/db/data/node/20/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/20/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/20/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/20/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/20/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/20/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/20/relationships/in/{-list|&amp;|types}"
}, {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/19/relationships/out",
  "data" : {
    "name" : "me"
  },
  "traverse" : "http://localhost:7474/db/data/node/19/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/19/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/19/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/19",
  "properties" : "http://localhost:7474/db/data/node/19/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/19/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/19/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/19/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/19/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/19/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/19/relationships/in/{-list|&amp;|types}"
} ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-emit-a-sample-graph"></a>22.18.10. Emit a sample graph</h3></div></div></div><p>Exporting a graph can be done by simple emitting the appropriate String.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">writer = new GraphMLWriter(g)
out = new java.io.ByteArrayOutputStream()
writer.outputGraph(out)
result = out.toString()</pre><div class="figure"><a id="idp13522768"></a><p class="title"><strong>Figure 22.65. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-Emit-a-sample-graph.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-Emit-a-sample-graph.svg" alt="Final-Graph-Emit-a-sample-graph.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "writer = new GraphMLWriter(g);out = new java.io.ByteArrayOutputStream();writer.outputGraph(out);result = out.toString();",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">"&lt;?xml version=\"1.0\" ?&gt;&lt;graphml xmlns=\"http://graphml.graphdrawing.org/xmlns\"&gt;&lt;key id=\"name\" for=\"node\" attr.name=\"name\" attr.type=\"string\"&gt;&lt;/key&gt;&lt;graph id=\"G\" edgedefault=\"directed\"&gt;&lt;node id=\"53\"&gt;&lt;data key=\"name\"&gt;you&lt;/data&gt;&lt;/node&gt;&lt;node id=\"54\"&gt;&lt;data key=\"name\"&gt;him&lt;/data&gt;&lt;/node&gt;&lt;node id=\"55\"&gt;&lt;data key=\"name\"&gt;I&lt;/data&gt;&lt;/node&gt;&lt;edge id=\"46\" source=\"55\" target=\"53\" label=\"know\"&gt;&lt;/edge&gt;&lt;edge id=\"47\" source=\"55\" target=\"54\" label=\"know\"&gt;&lt;/edge&gt;&lt;/graph&gt;&lt;/graphml&gt;"</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-hyperedges---find-user-roles-in-groups"></a>22.18.11. HyperEdges - find user roles in groups</h3></div></div></div><p>Imagine a user being part of different groups. A group can have different
roles, and a user can be part of different groups. He also can have
different roles in different groups apart from the membership. The
association of a User, a Group and a Role can be referred to as a
<span class="emphasis"><em>HyperEdge</em></span>. However, it can be easily modeled in a property graph as a
node that captures this n-ary relationship, as depicted below in the
<code class="literal">U1G2R1</code> node.</p><p>To find out in what roles a user is for a particular groups (here
<span class="emphasis"><em>Group2</em></span>), the following script can traverse this HyperEdge node and
provide answers.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.v(39).out('hasRoleInGroup').as('hyperedge').out('hasGroup').filter{it.name=='Group2'}.back('hyperedge').out('hasRole').name</pre><div class="figure"><a id="idp13551008"></a><p class="title"><strong>Figure 22.66. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-HyperEdges---find-user-roles-in-groups.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-HyperEdges---find-user-roles-in-groups.svg" alt="Final-Graph-HyperEdges---find-user-roles-in-groups.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.v(39).out('hasRoleInGroup').as('hyperedge').out('hasGroup').filter{it.name=='Group2'}.back('hyperedge').out('hasRole').name",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ "Role1" ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-group-count"></a>22.18.12. Group count</h3></div></div></div><p>This example is showing a group count in Gremlin, for instance the
counting of the different relationship types connected to some the start
node. The result is collected into a variable that then is returned.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">m = [:]
g.v(60).bothE().label.groupCount(m).iterate()
m</pre><div class="figure"><a id="idp13575696"></a><p class="title"><strong>Figure 22.67. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-group-count.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-group-count.svg" alt="Final-Graph-group-count.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "m = [:];g.v(60).bothE().label.groupCount(m).iterate();m",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "knows" : 2,
  "likes" : 1
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-collect-multiple-traversal-results"></a>22.18.13. Collect multiple traversal results</h3></div></div></div><p>Multiple traversals can be combined into a single result, using splitting
and merging pipes in a lazy fashion.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.idx('node_auto_index')[[name:'Peter']].copySplit(_().out('knows'), _().in('likes')).fairMerge.name</pre><div class="figure"><a id="idp13600320"></a><p class="title"><strong>Figure 22.68. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-collect-multiple-traversal-results.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-collect-multiple-traversal-results.svg" alt="Final-Graph-collect-multiple-traversal-results.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.idx('node_auto_index')[[name:'Peter']].copySplit(_().out('knows'), _().in('likes')).fairMerge.name",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ "Ian", "Marie" ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-collaborative-filtering"></a>22.18.14. Collaborative filtering</h3></div></div></div><p>This example demonstrates basic collaborative filtering - ordering a
traversal after occurence counts and substracting objects that are not
interesting in the final result.</p><p>Here, we are finding Friends-of-Friends that are not Joes friends
already. The same can be applied to graphs of users that <code class="literal">LIKE</code> things
and others.</p><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">x=[]
fof=[:]
g.v(12).out('knows').aggregate(x).out('knows').except(x).groupCount(fof).iterate()
fof.sort{a,b -&gt; b.value &lt;=&gt; a.value}</pre><div class="figure"><a id="idp13626528"></a><p class="title"><strong>Figure 22.69. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-collaborative-filtering.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-collaborative-filtering.svg" alt="Final-Graph-collaborative-filtering.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "x=[];fof=[:];g.v(12).out('knows').aggregate(x).out('knows').except(x).groupCount(fof).iterate();fof.sort{a,b -&gt; b.value &lt;=&gt; a.value}",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "v[10]" : 2,
  "v[9]" : 1,
  "v[11]" : 1
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-chunking-and-offsetting-in-gremlin"></a>22.18.15. Chunking and offsetting in Gremlin</h3></div></div></div><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.v(30).out('knows').filter{it.name == 'Sara'}[0..100]</pre><div class="figure"><a id="idp13650528"></a><p class="title"><strong>Figure 22.70. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-chunking-and-offsetting-in-Gremlin.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-chunking-and-offsetting-in-Gremlin.svg" alt="Final-Graph-chunking-and-offsetting-in-Gremlin.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.v(30).out('knows').filter{it.name == 'Sara'}[0..100]",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ {
  "outgoing_relationships" : "http://localhost:7474/db/data/node/28/relationships/out",
  "data" : {
    "name" : "Sara"
  },
  "traverse" : "http://localhost:7474/db/data/node/28/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/28/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/28/properties/{key}",
  "self" : "http://localhost:7474/db/data/node/28",
  "properties" : "http://localhost:7474/db/data/node/28/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/28/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/28/relationships/in",
  "extensions" : {
  },
  "create_relationship" : "http://localhost:7474/db/data/node/28/relationships",
  "paged_traverse" : "http://localhost:7474/db/data/node/28/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "all_relationships" : "http://localhost:7474/db/data/node/28/relationships/all",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/28/relationships/in/{-list|&amp;|types}"
} ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-this-example-shows-how-to-modify-the-graph-while-traversing-it"></a>22.18.16. This example shows how to modify the graph while traversing it</h3></div></div></div><p>In this
case, the Peter node is disconnected from all other nodes.</p><div class="figure"><a id="idp13674496"></a><p class="title"><strong>Figure 22.71. Starting Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Starting-Graph-starting_graphThis-example-shows-how-to-modify-the-graph-while-traversing-it.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Starting-Graph-starting_graphThis-example-shows-how-to-modify-the-graph-while-traversing-it.svg" alt="Starting-Graph-starting_graphThis-example-shows-how-to-modify-the-graph-while-traversing-it.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">g.v(77).bothE.each{g.removeEdge(it)}</pre><div class="figure"><a id="idp13679968"></a><p class="title"><strong>Figure 22.72. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-This-example-shows-how-to-modify-the-graph-while-traversing-it.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-This-example-shows-how-to-modify-the-graph-while-traversing-it.svg" alt="Final-Graph-This-example-shows-how-to-modify-the-graph-while-traversing-it.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.v(77).bothE.each{g.removeEdge(it)}",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">[ ]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-flow-algorithms-with-gremlin"></a>22.18.17. Flow algorithms with Gremlin</h3></div></div></div><p>This is a basic stub example for implementing flow algorithms in for
instance <a class="ulink" href="http://en.wikipedia.org/wiki/Flow_network" target="_top">Flow Networks</a> with a
pipes-based approach and scripting, here between <code class="literal">source</code> and <code class="literal">sink</code>
using the <code class="literal">capacity</code> property on relationships as the base for the flow
function and modifying the graph during calculation.</p><div class="figure"><a id="idp13705840"></a><p class="title"><strong>Figure 22.73. Starting Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Starting-Graph-starting_graphflow-algorithms-with-Gremlin.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Starting-Graph-starting_graphflow-algorithms-with-Gremlin.svg" alt="Starting-Graph-starting_graphflow-algorithms-with-Gremlin.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Raw script source</em></span></p><pre class="programlisting brush: groovy">source=g.v(79)
sink=g.v(80)
maxFlow = 0
source.outE.inV.loop(2){!it.object.equals(sink)}.paths.each{flow = it.capacity.min()
 maxFlow += flow
it.findAll{it.capacity}.each{it.capacity -= flow}}
maxFlow</pre><div class="figure"><a id="idp13711472"></a><p class="title"><strong>Figure 22.74. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-flow-algorithms-with-Gremlin.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-flow-algorithms-with-Gremlin.svg" alt="Final-Graph-flow-algorithms-with-Gremlin.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "source=g.v(79);sink=g.v(80);maxFlow = 0;source.outE.inV.loop(2){!it.object.equals(sink)}.paths.each{flow = it.capacity.min(); maxFlow += flow;it.findAll{it.capacity}.each{it.capacity -= flow}};maxFlow",
  "params" : {
  }
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">200:</code></strong></span> <code class="literal">OK</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">4</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="rest-api-script-execution-errors"></a>22.18.18. Script execution errors</h3></div></div></div><p>Script errors
will result in an HTTP error response code.</p><div class="figure"><a id="idp13734352"></a><p class="title"><strong>Figure 22.75. Final Graph</strong></p><div class="figure-contents"><a class="ulink" href="images/Final-Graph-script-execution-errors.svg" target="_top">
<span class="inlinemediaobject"><img src="images/Final-Graph-script-execution-errors.svg" alt="Final-Graph-script-execution-errors.svg" /></span>
</a></div></div><br class="figure-break" /><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/ext/GremlinPlugin/graphdb/execute_script</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "script" : "g.addVertex([name:{}])"
}</pre><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">400:</code></strong></span> <code class="literal">Bad Request</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Content-Type:</code></strong></span> <code class="literal">application/json; charset=UTF-8</code>
</li></ul></div><pre class="programlisting brush: javascript">{
  "message": "javax.script.ScriptException: java.lang.IllegalArgumentException: Unknown property type on: Script9$_run_closure1@5e21151e, class Script9$_run_closure1",
  "exception": "BadInputException",
  "fullname": "org.neo4j.server.rest.repr.BadInputException",
  "stacktrace": [
    "org.neo4j.server.plugin.gremlin.GremlinPlugin.executeScript(GremlinPlugin.java:84)",
    "java.lang.reflect.Method.invoke(Method.java:597)",
    "org.neo4j.server.plugins.PluginMethod.invoke(PluginMethod.java:57)",
    "org.neo4j.server.plugins.PluginManager.invoke(PluginManager.java:168)",
    "org.neo4j.server.rest.web.ExtensionService.invokeGraphDatabaseExtension(ExtensionService.java:300)",
    "org.neo4j.server.rest.web.ExtensionService.invokeGraphDatabaseExtension(ExtensionService.java:122)",
    "java.lang.reflect.Method.invoke(Method.java:597)",
    "org.neo4j.server.rest.security.SecurityFilter.doFilter(SecurityFilter.java:112)"
  ]
}</pre></div></div><HR xmlns=""></HR><a xmlns="" href="ln-idp1112768.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2014 Neo Technology</p></a><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="rest-api-wadl-support.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="rest-api.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="deprecations.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>
